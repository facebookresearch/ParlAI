<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ParlAI: projects/dialogue_safety/README.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ParlAI
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">projects/dialogue_safety/README.md</div>  </div>
</div><!--header-->
<div class="contents">
<a href="projects_2dialogue__safety_2README_8md.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;# Build it Break it Fix it for Dialogue Safety: Robustness from Adversarial Human Attack</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;## Paper information</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Emily Dinan, Samuel Humeau, Bharath Chintagunta, Jason Weston.</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;_[Build it Break it Fix it for Dialogue Safety: Robustness from Adversarial Human Attack](https://arxiv.org/abs/1908.06083)_.</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;To appear at EMNLP 2019.</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&lt;p align=&quot;center&quot;&gt;&lt;img width=&quot;60%&quot; src=&quot;diagram.png&quot; /&gt;&lt;/p&gt;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;## Abstract</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;The detection of offensive language in the context of a dialogue has become an increasingly important application of natural language processing. The detection of trolls in public forums (Galán-García et al., 2016), and the deployment of chatbots in the public domain (Wolf et al., 2017) are two examples that show the necessity of guarding against adversarially offensive behavior on the part of humans. In this work, we develop a training scheme for a model to become robust to such human attacks by an iterative build it, break it, fix it strategy with humans and models in the loop. In detailed experiments we show this approach is considerably more robust than previous systems. Further, we show that offensive language used within a conversation critically depends on the dialogue context, and cannot be viewed as a single sentence offensive detection task as in most previous work. Our newly collected tasks and methods will be made open source and publicly available.</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;## Data examples</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;To view the data for round 1 of the single turn **adversarial** data, try running:</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;```bash</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;python examples/display_data.py -t dialogue_safety:adversarial --round 1</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;```</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;To view the data for rounds 1-3 of the single turn **standard** data, try running:</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;```bash</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;python examples/display_data.py -t dialogue_safety:standard --round 3</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;```</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;To view the data for *only* rounds 2 of the single turn **adversarial** data, try running:</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;```bash</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;python examples/display_data.py -t dialogue_safety:adversarial --round 2 --round-only True</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;```</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;To view the data from the **multi-turn adversarial** setting, try running:</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;```bash</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;python examples/display_data.py -t dialogue_safety:multiturn</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;```</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;To view the same data (the **multi-turn adversarial** data), but without the context text provided, try running:</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;```bash</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;python examples/display_data.py -t dialogue_safety:multiturn --single-turn True</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;```</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;## Pre-trained models</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;Evaluate a pre-trained Transformer-based model on the test sets of rounds 1-3 or the **adversarial** task:</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;```bash</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;python examples/eval_model.py -t dialogue_safety:adversarial --round 3 -dt test -mf zoo:dialogue_safety/single_turn/model -bs 40</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;```</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;Evaluate the same pre-trained Transformer-based model on the test sets of rounds 1-3 or the **standard** task:</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;```bash</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;python examples/eval_model.py -t dialogue_safety:standard --round 3 -dt test -mf zoo:dialogue_safety/single_turn/model -bs 40</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;```</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;Interact with the single-turn model to see its classifications of your input in real time:</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;```bash</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;python examples/interactive.py -mf zoo:dialogue_safety/single_turn/model --print-scores True --single-turn True</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;```</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;Here are some example outputs from the above script:</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;```bash</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;Enter Your Message: hi how are you?</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;[TransformerClassifier]: Predicted class: __ok__</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;with probability: 0.9996</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;Enter Your Message: i hate you</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;[TransformerClassifier]: Predicted class: __notok__</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;with probability: 0.9995</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;```</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;Evaluate a BERT-based model (using *segments* to distinguish the context from the utterance to be classified, as described in the paper) on the test set of the **multi-turn adversarial** task:</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;```bash</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;python examples/eval_model.py -t dialogue_safety:multiturn -dt test -mf zoo:dialogue_safety/multi_turn/model --split-lines True -bs 40</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;```</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;## Training examples</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;Multi-task a model on the Wikipedia Toxic Comments dataset in addition to rounds 1-3 the adversarial and standard tasks, fine-tuning on top of a pretrained transformer model:</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;```bash</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;python examples/train_model.py -t dialogue_safety:WikiToxicComments,dialogue_safety:adversarial,dialogue_safety:adversarial --load-from-pretrained-ranker True --init-model zoo:pretrained_transformers/bi_model_huge_reddit/model --dict-file zoo:pretrained_transformers/bi_model_huge_reddit/model.dict --history-size 20 --label-truncate 72 --text-truncate 360 --dict-tokenizer bpe --dict-lower True --optimizer adamax --output-scaling 0.06 --variant xlm --reduction-type mean --share-encoders False --learn-positional-embeddings True --n-layers 12 --n-heads 12 --ffn-size 3072 --attention-dropout 0.1 --relu-dropout 0.0 --dropout 0.1 --n-positions 1024 --embedding-size 768 --activation gelu  --embeddings-scale False --n-segments 2 --learn-embeddings True --share-word-embeddings False --dict-endtoken __start__ --classes __notok__ __ok__ --round 3 --use-test-set True --model transformer_classifier --multitask-weights 0.6,0.2,0.2 -lr 5e-05 --shuffle True -bs 20 --data-parallel True -vtim 60 -vp 30 -stim 60 -vme 10000 --lr-scheduler fixed --lr-scheduler-patience 3 --lr-scheduler-decay 0.9 --warmup_updates 1000 --validation-metric class___notok___f1 --validation-metric-mode max --save-after-valid True --model-file /tmp/safety_model_example</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;```</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;## Acknowledgments</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;*The emoji image in the diagram is by [Twemoji](https://github.com/twitter/twemoji), and is licensed under CC BY-4.0.*</div></div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
