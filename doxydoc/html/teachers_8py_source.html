<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ParlAI: parlai/core/teachers.py Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ParlAI
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5fa64f6a890d29028c37756abca1c9f7.html">parlai</a></li><li class="navelem"><a class="el" href="dir_7382978de463cb1e8d3dc3d2b174b23d.html">core</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">teachers.py</div>  </div>
</div><!--header-->
<div class="contents">
<a href="teachers_8py.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno"><a class="line" href="namespaceparlai_1_1core_1_1teachers.html">    1</a></span>&#160;<span class="comment">#!/usr/bin/env python3</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"># Copyright (c) Facebook, Inc. and its affiliates.</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"># This source code is licensed under the MIT license found in the</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"># LICENSE file in the root directory of this source tree.</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="stringliteral">This module provides a set of teachers that deal with dialog.</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="stringliteral">    ``FixedDialogTeacher(Teacher)``</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="stringliteral">    Base class for teachers in tasks that have fixed dialog - i.e., dialog</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="stringliteral">    that is not dynamically generated but rather is pulled from set examples.</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="stringliteral">    However, the class can be extended to all tasks involved fixed data.</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="stringliteral">    Implements much of the basic functionality of these teachers, including</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="stringliteral">    ``observe()``, ``act()``, ``next_example()``</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="stringliteral">    ``DialogTeacher(FixedDialogTeacher)``</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="stringliteral">     Base teacher class for doing dialog specifically with fixed chat logs.</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="stringliteral">    ``FbDialogTeacher(DialogTeacher)``</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="stringliteral">     Teacher class that provides access to data in the Facebook Dialog format.</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="stringliteral">     See the class description for more details.</span></div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="stringliteral">     ** NOTE: ** We plan to deprecate this method soon in favor of ParlAIDialogTeacher,</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="stringliteral">     however several existing tasks are currently still using it.</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="stringliteral">    ``ParlAIDialogTeacher(DialogTeacher)``</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="stringliteral">     Teacher class that provides access to data in the ParlAI Dialog format.</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="stringliteral">     See the class description for more details.</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="stringliteral">This module also includes ``DataLoader``, a threadpool data loader for</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="stringliteral">``FixedDialogTeacher``, and ``DialogData``/``StreamDialogData``, data</span></div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="stringliteral">structures for accessing textual dialog data and utilized by ``DialogTeacher``</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceparlai_1_1core_1_1agents.html">parlai.core.agents</a> <span class="keyword">import</span> Teacher</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceparlai_1_1core_1_1image__featurizers.html">parlai.core.image_featurizers</a> <span class="keyword">import</span> ImageLoader</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceparlai_1_1core_1_1message.html">parlai.core.message</a> <span class="keyword">import</span> Message</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="keyword">from</span> <a class="code" href="namespaceparlai_1_1utils_1_1misc.html">parlai.utils.misc</a> <span class="keyword">import</span> AttrDict, no_lock, str_to_msg, warn_once</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="keyword">from</span> abc <span class="keyword">import</span> abstractmethod</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="keyword">import</span> concurrent.futures</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="keyword">import</span> multiprocessing</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Value, Lock</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="keyword">from</span> threading <span class="keyword">import</span> Thread</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;<span class="keyword">import</span> queue</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keyword">import</span> random</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="keyword">import</span> sys</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keyword">import</span> time</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">import</span> os</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">import</span> torch</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keyword">import</span> json</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keyword">import</span> argparse</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div><div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DataLoader.html">   56</a></span>&#160;<span class="keyword">class </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DataLoader.html">DataLoader</a>(Thread):</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="stringliteral">    A worker thread that provides a threadpool for data loading.</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="stringliteral">    A teacher may submit a request to the loader, which will return the</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="stringliteral">    appropriate data.</span></div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="stringliteral">    To submit a request, a teacher should call ``request_load``.</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;</div><div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DataLoader.html#af06f90bbe1a2d310ac43e963c2eb8f88">   66</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DataLoader.html#af06f90bbe1a2d310ac43e963c2eb8f88">__init__</a>(self, opt):</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        Thread.__init__(self, daemon=<span class="keyword">True</span>)</div><div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DataLoader.html#a223a0d846ce98840f8f3338611f94d34">   68</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DataLoader.html#a223a0d846ce98840f8f3338611f94d34">num_workers</a> = opt.get(<span class="stringliteral">&#39;num_load_threads&#39;</span>, 1)</div><div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DataLoader.html#a960bf1159e437cfb304352213df50a8f">   69</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DataLoader.html#a960bf1159e437cfb304352213df50a8f">request_queue</a> = queue.Queue()</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div><div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DataLoader.html#a06bfd397f84fd1e2d0d64d64182ae5f5">   71</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DataLoader.html#a06bfd397f84fd1e2d0d64d64182ae5f5">request_load</a>(self, receive_fn, load_fn, args):</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="stringliteral">        Queue a request for loading.</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="stringliteral">        :param receive_fn:</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="stringliteral">            a receive function (for receiving the data)</span></div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="stringliteral">        :param load_fn:</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="stringliteral">            a load function (for loading the data)</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="stringliteral">        :param args:</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="stringliteral">            arguments for the load function. args can be either a dictionary of</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="stringliteral">            arguments for a function, or a list of positional arguments</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DataLoader.html#a960bf1159e437cfb304352213df50a8f">request_queue</a>.put((receive_fn, load_fn, args))</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DataLoader.html#a2663781dd1e8cc85535e3cb075fbb8b7">   85</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DataLoader.html#a2663781dd1e8cc85535e3cb075fbb8b7">run</a>(self):</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Run the execution loop.&quot;&quot;&quot;</span></div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        executor = concurrent.futures.ThreadPoolExecutor(max_workers=self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DataLoader.html#a223a0d846ce98840f8f3338611f94d34">num_workers</a>)</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        with executor:</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <span class="keywordflow">while</span> <span class="keyword">True</span>:</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                receive_fn, load_fn, args = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DataLoader.html#a960bf1159e437cfb304352213df50a8f">request_queue</a>.get()</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                <span class="keywordflow">if</span> <a class="code" href="namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf.html#ad5dfae268e23f506da084a9efb72f619">type</a>(args) == dict:</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                    future = executor.submit(load_fn, **args)</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                    future = executor.submit(load_fn, *args)</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                receive_fn(future)</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div><div class="line"><a name="l00098"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html">   98</a></span>&#160;<span class="keyword">class </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html">FixedDialogTeacher</a>(<a class="code" href="classparlai_1_1core_1_1agents_1_1Teacher.html">Teacher</a>):</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="stringliteral">    A teacher agent for all teachers involved in tasks with fixed data.</span></div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="stringliteral">    This class provides the following functionality for its subclasses:</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="stringliteral">    - Resets a teacher</span></div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="stringliteral">    - Provides an observe method</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;<span class="stringliteral">    - Computes and retrieves the next episode index for a teacher</span></div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="stringliteral">    - Provides a threadpool option for loading data (especially useful for</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="stringliteral">      large data, e.g. images)</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="stringliteral">    In order to take advantage of the first few features, all a subclass has to</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="stringliteral">    implement is three functions: ``num_episodes``, ``num_examples``, and</span></div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="stringliteral">    ``get`` (which returns a specific example from a specific episode).</span></div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="stringliteral">    To utilize the DataLoader for threadpool loading, a teacher should</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="stringliteral">    implement the ``submit_load_request`` function to send a load request</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="stringliteral">    to the DataLoader by calling ``self.data_loader.request_load`` with the</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="stringliteral">    appropriate arguments (``receive_fn, load_fn, args``). The DataLoader then</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="stringliteral">    returns the data to the teacher&#39;s ``data_queue``, which the teacher can</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="stringliteral">    poll in its ``act`` method.</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="stringliteral">    The following is an example of the DataLoader usage in the VQA-V1 teacher.</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="stringliteral">    1. In the teacher&#39;s ``init`` function, the teacher calls its</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="stringliteral">       ``submit_load_request`` function to preload an image.</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="stringliteral">    2. The ``submit_load_request`` function gets the next ``episode_idx``,</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="stringliteral">       and computes the image path for the load request.</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="stringliteral">    3. At the end of ``submit_load_request``, the teacher calls</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="stringliteral">       ``self.data_loader.request_load`` with three args:</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="stringliteral">        - ``self.receive_data`` - the function that the DataLoader calls to</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="stringliteral">          return the the loaded object</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="stringliteral">        - ``self.image_loader.load`` - the function used to load the image</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="stringliteral">          from the image path</span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="stringliteral">        - ``[img_path]`` - a list of arguments for the load function, which</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="stringliteral">          in this case is the path of the image.</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="stringliteral">    4. In the teacher&#39;s ``act`` function, the teacher loads the data from</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="stringliteral">       its data queue.</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="stringliteral">    5. At the end of the ``act`` function, the teacher calls</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="stringliteral">       ``submit_load_request`` to preload an image for the next example.</span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="stringliteral">    To see this in action, take a look at this teacher in ``tasks.vqa_v1.agents``.</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div><div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#adbbee971d8b6eabae13165060e901c40">  145</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#adbbee971d8b6eabae13165060e901c40">__init__</a>(self, opt, shared=None):</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#adbbee971d8b6eabae13165060e901c40">__init__</a>(opt, shared)</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasattr(self, <span class="stringliteral">&#39;datatype&#39;</span>):</div><div class="line"><a name="l00149"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a65c9039b783299ad6033ccbb995ca493">  149</a></span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a65c9039b783299ad6033ccbb995ca493">datatype</a> = opt[<span class="stringliteral">&#39;datatype&#39;</span>]</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasattr(self, <span class="stringliteral">&#39;random&#39;</span>):</div><div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7e5054e18ce919c0eb04188c801ddef1">  151</a></span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7e5054e18ce919c0eb04188c801ddef1">random</a> = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a65c9039b783299ad6033ccbb995ca493">datatype</a> == <span class="stringliteral">&#39;train&#39;</span></div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasattr(self, <span class="stringliteral">&#39;training&#39;</span>):</div><div class="line"><a name="l00153"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#af64b55521fe587c17696b0b805a2b0d4">  153</a></span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#af64b55521fe587c17696b0b805a2b0d4">training</a> = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a65c9039b783299ad6033ccbb995ca493">datatype</a>.startswith(<span class="stringliteral">&#39;train&#39;</span>)</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasattr(self, <span class="stringliteral">&#39;datafile&#39;</span>):</div><div class="line"><a name="l00155"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a822d9f5c86ab0b0c608ae26901d3dec3">  155</a></span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a822d9f5c86ab0b0c608ae26901d3dec3">datafile</a> = opt.get(<span class="stringliteral">&#39;datafile&#39;</span>, opt.get(<span class="stringliteral">&#39;pytorch_datafile&#39;</span>))</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        <span class="comment"># set up support for multithreaded data loading</span></div><div class="line"><a name="l00157"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a59d9cf6a9e7f64a5d9a8d180ed06c001">  157</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a59d9cf6a9e7f64a5d9a8d180ed06c001">data_queue</a> = queue.Queue()</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <span class="keywordflow">if</span> shared:</div><div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a73ac86c06c926ab7aedd73d49e3bb2b5">  159</a></span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a73ac86c06c926ab7aedd73d49e3bb2b5">index</a> = shared[<span class="stringliteral">&#39;index&#39;</span>]</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;data_loader&#39;</span> <span class="keywordflow">in</span> shared:</div><div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7edc6520195726382082a76486fa3747">  161</a></span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7edc6520195726382082a76486fa3747">data_loader</a> = shared[<span class="stringliteral">&#39;data_loader&#39;</span>]</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;threadindex&#39;</span> <span class="keywordflow">in</span> shared:</div><div class="line"><a name="l00163"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a4443c43dc20f8f817c8cf28e2d795d6d">  163</a></span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a4443c43dc20f8f817c8cf28e2d795d6d">threadindex</a> = shared[<span class="stringliteral">&#39;threadindex&#39;</span>]</div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;examples&#39;</span> <span class="keywordflow">in</span> shared:</div><div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a95eb8aeb051fc81a10ac7e1a7d5fed3d">  165</a></span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a95eb8aeb051fc81a10ac7e1a7d5fed3d">examples</a> = shared[<span class="stringliteral">&#39;examples&#39;</span>]</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a73ac86c06c926ab7aedd73d49e3bb2b5">index</a> = <a class="code" href="classparlai_1_1utils_1_1misc_1_1AttrDict.html">AttrDict</a>(value=-1)</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasattr(self, <span class="stringliteral">&#39;data_loader&#39;</span>):</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7edc6520195726382082a76486fa3747">data_loader</a> = <a class="code" href="classparlai_1_1core_1_1teachers_1_1DataLoader.html">DataLoader</a>(opt)</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7edc6520195726382082a76486fa3747">data_loader</a>.start()</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="comment"># set up batching</span></div><div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a2f6069ff207d360edf2729c245ceaa0f">  174</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a2f6069ff207d360edf2729c245ceaa0f">bsz</a> = opt.get(<span class="stringliteral">&#39;batchsize&#39;</span>, 1)</div><div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a468d55710137a42b18f85212d7068c47">  175</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a468d55710137a42b18f85212d7068c47">batchindex</a> = opt.get(<span class="stringliteral">&#39;batchindex&#39;</span>, 0)</div><div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a8a551d24fa77a0eb880cbee90b507f7e">  176</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a8a551d24fa77a0eb880cbee90b507f7e">use_batch_act</a> = <span class="keyword">False</span>  <span class="comment"># Batch act disabled by default</span></div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keyword">def </span>_lock(self):</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">if</span> hasattr(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a73ac86c06c926ab7aedd73d49e3bb2b5">index</a>, <span class="stringliteral">&#39;get_lock&#39;</span>):</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a73ac86c06c926ab7aedd73d49e3bb2b5">index</a>.get_lock()</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="namespaceparlai_1_1utils_1_1misc.html#a38a23cfa0fc3dbed42846787d1c04b57">no_lock</a>()</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div><div class="line"><a name="l00184"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#af0e1160f17d43ace896f71c190e4e5ec">  184</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#af0e1160f17d43ace896f71c190e4e5ec">reset</a>(self):</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Reset the dialog to the start of the epoch, and reset all metrics.&quot;&quot;&quot;</span></div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;        super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#af0e1160f17d43ace896f71c190e4e5ec">reset</a>()</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Teacher.html#a159705efe2a9f389d8adfdad76891f08">metrics</a>.clear()</div><div class="line"><a name="l00188"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#abf7e9a8868478220ca4df71dadeed4a9">  188</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#abf7e9a8868478220ca4df71dadeed4a9">lastY</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00189"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a86428affae9471df880dd5e8dc4b90ed">  189</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a86428affae9471df880dd5e8dc4b90ed">episode_done</a> = <span class="keyword">True</span></div><div class="line"><a name="l00190"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a2fec0a004a2ea81402a66244c62b8607">  190</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Teacher.html#a2a21915f2270b76ba0e99137d506af89">epochDone</a> = <span class="keyword">False</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a59d9cf6a9e7f64a5d9a8d180ed06c001">data_queue</a> = queue.Queue()</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div><div class="line"><a name="l00193"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#afd4ebab8063eb42d182d30a1a41f133e">  193</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#afd4ebab8063eb42d182d30a1a41f133e">episode_idx</a> = -1</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;        with self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a23f1b4d0d81a1e63ecd8dded6de37578">_lock</a>():</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a73ac86c06c926ab7aedd73d49e3bb2b5">index</a>.value = -1</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div><div class="line"><a name="l00197"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a8923ee1255939443c7a6ea1532a2fe40">  197</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a8923ee1255939443c7a6ea1532a2fe40">submit_load_request</a>(self):</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="stringliteral">        Submit a load request.</span></div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="stringliteral">        An agent should implement this method to submit requests to the data</span></div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="stringliteral">        loader. At the end of this method, the agent should call</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="stringliteral">        ``self.data_loader.request_load()`` with the appropriate args.</span></div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="stringliteral">        By default, this method does nothing.</span></div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="comment"># TODO: mark as abstract</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">pass</span></div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div><div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a001ed7924490d0e291588c54d383384a">  210</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a001ed7924490d0e291588c54d383384a">receive_data</a>(self, future):</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="stringliteral">        Receive data from the data loader.</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;<span class="stringliteral">        :param future: result from the load request.</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        data = future.result()</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        self.data_queue.put(data)</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div><div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#af1501d26676b7cf0ed8f41d51c31e686">  219</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#af1501d26676b7cf0ed8f41d51c31e686">share</a>(self):</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Share the data and dataloader.&quot;&quot;&quot;</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        shared = super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#af1501d26676b7cf0ed8f41d51c31e686">share</a>()</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="keywordflow">if</span> hasattr(self, <span class="stringliteral">&#39;lastYs&#39;</span>):</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <span class="comment"># share lastYs to communicate between batch_act and observe</span></div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            shared[<span class="stringliteral">&#39;lastYs&#39;</span>] = self.lastYs</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="keywordflow">if</span> hasattr(self, <span class="stringliteral">&#39;examples&#39;</span>):</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            shared[<span class="stringliteral">&#39;examples&#39;</span>] = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a95eb8aeb051fc81a10ac7e1a7d5fed3d">examples</a></div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <span class="keywordflow">if</span> hasattr(self, <span class="stringliteral">&#39;data_loader&#39;</span>):</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            shared[<span class="stringliteral">&#39;data_loader&#39;</span>] = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7edc6520195726382082a76486fa3747">data_loader</a></div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Agent.html#ab3b45d2754244608c75d4068b90cd051">opt</a>.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7c4cbfbe5cf6e9dbdf8c00d140ef4e7e">get</a>(<span class="stringliteral">&#39;numthreads&#39;</span>, 1) &gt; 1:</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="keywordflow">if</span> <a class="code" href="namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf.html#ad5dfae268e23f506da084a9efb72f619">type</a>(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a73ac86c06c926ab7aedd73d49e3bb2b5">index</a>) <span class="keywordflow">is</span> <span class="keywordflow">not</span> multiprocessing.sharedctypes.Synchronized:</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                <span class="comment"># for multithreading need to move index into threadsafe memory</span></div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a73ac86c06c926ab7aedd73d49e3bb2b5">index</a> = Value(<span class="stringliteral">&#39;l&#39;</span>, -1)</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        shared[<span class="stringliteral">&#39;index&#39;</span>] = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a73ac86c06c926ab7aedd73d49e3bb2b5">index</a></div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <span class="keywordflow">return</span> shared</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;</div><div class="line"><a name="l00242"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7fccfc09aef3510f8bb9834398eff8e9">  242</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7fccfc09aef3510f8bb9834398eff8e9">next_episode_idx</a>(self, num_eps=None, loop=None):</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;<span class="stringliteral">        Return the next episode index.</span></div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="stringliteral">        :param num_eps:</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="stringliteral">            default None uses ``num_episodes`` value.</span></div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="stringliteral">        :param loop:</span></div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="stringliteral">            default None loops during training but not evaluation.</span></div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        <span class="keywordflow">if</span> num_eps <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            num_eps = self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Teacher.html#aa35e171610f8dd8e6a2fd5a87ad91e10">num_episodes</a>()</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;        <span class="keywordflow">if</span> loop <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            loop = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#af64b55521fe587c17696b0b805a2b0d4">training</a></div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7e5054e18ce919c0eb04188c801ddef1">random</a>:</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            new_idx = random.randrange(num_eps)</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            with self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a23f1b4d0d81a1e63ecd8dded6de37578">_lock</a>():</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a73ac86c06c926ab7aedd73d49e3bb2b5">index</a>.value += 1</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                <span class="keywordflow">if</span> loop:</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                    self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a73ac86c06c926ab7aedd73d49e3bb2b5">index</a>.value %= num_eps</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                new_idx = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a73ac86c06c926ab7aedd73d49e3bb2b5">index</a>.value</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;        <span class="keywordflow">return</span> new_idx</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;</div><div class="line"><a name="l00265"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#aa6782a610b00aa0675522aa58b03f20c">  265</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#aa6782a610b00aa0675522aa58b03f20c">next_example</a>(self):</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;<span class="stringliteral">        Return the next example.</span></div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;<span class="stringliteral">        If there are multiple examples in the same episode, returns the next</span></div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;<span class="stringliteral">        one in that episode. If that episode is over, gets a new episode index</span></div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;<span class="stringliteral">        and returns the first example of that episode.</span></div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a86428affae9471df880dd5e8dc4b90ed">episode_done</a>:</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#afd4ebab8063eb42d182d30a1a41f133e">episode_idx</a> = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7fccfc09aef3510f8bb9834398eff8e9">next_episode_idx</a>()</div><div class="line"><a name="l00275"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#ae3201b15f3c3b46a2f3511bad9b43e7d">  275</a></span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#ae3201b15f3c3b46a2f3511bad9b43e7d">entry_idx</a> = 0</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#ae3201b15f3c3b46a2f3511bad9b43e7d">entry_idx</a> += 1</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#afd4ebab8063eb42d182d30a1a41f133e">episode_idx</a> &gt;= self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Teacher.html#aa35e171610f8dd8e6a2fd5a87ad91e10">num_episodes</a>():</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            <span class="keywordflow">return</span> {<span class="stringliteral">&#39;episode_done&#39;</span>: <span class="keyword">True</span>}, <span class="keyword">True</span></div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        ex = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7c4cbfbe5cf6e9dbdf8c00d140ef4e7e">get</a>(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#afd4ebab8063eb42d182d30a1a41f133e">episode_idx</a>, self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#ae3201b15f3c3b46a2f3511bad9b43e7d">entry_idx</a>)</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a86428affae9471df880dd5e8dc4b90ed">episode_done</a> = ex.get(<span class="stringliteral">&#39;episode_done&#39;</span>, <span class="keyword">False</span>)</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">if</span> (</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;            <span class="keywordflow">not</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7e5054e18ce919c0eb04188c801ddef1">random</a></div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            <span class="keywordflow">and</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a86428affae9471df880dd5e8dc4b90ed">episode_done</a></div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            <span class="keywordflow">and</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#afd4ebab8063eb42d182d30a1a41f133e">episode_idx</a> + self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Agent.html#ab3b45d2754244608c75d4068b90cd051">opt</a>.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7c4cbfbe5cf6e9dbdf8c00d140ef4e7e">get</a>(<span class="stringliteral">&quot;batchsize&quot;</span>, 1) &gt;= self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Teacher.html#aa35e171610f8dd8e6a2fd5a87ad91e10">num_episodes</a>()</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        ):</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            epoch_done = <span class="keyword">True</span></div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            epoch_done = <span class="keyword">False</span></div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;        <span class="keywordflow">return</span> ex, epoch_done</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;</div><div class="line"><a name="l00296"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a49100faf9af79c6e24ddac9e36151d54">  296</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a49100faf9af79c6e24ddac9e36151d54">next_batch</a>(self):</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Return the next batch of examples.&quot;&quot;&quot;</span></div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        <span class="comment"># get next batch</span></div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;        with self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a23f1b4d0d81a1e63ecd8dded6de37578">_lock</a>():</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a73ac86c06c926ab7aedd73d49e3bb2b5">index</a>.value += 1</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#af64b55521fe587c17696b0b805a2b0d4">training</a>:</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a73ac86c06c926ab7aedd73d49e3bb2b5">index</a>.value %= len(self.batches)</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            batch_idx = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a73ac86c06c926ab7aedd73d49e3bb2b5">index</a>.value</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            <span class="keywordflow">if</span> batch_idx + 1 &gt;= len(self.batches):</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7e5054e18ce919c0eb04188c801ddef1">random</a>:</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                    random.shuffle(self.batches)</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Teacher.html#a2a21915f2270b76ba0e99137d506af89">epochDone</a> = <span class="keyword">True</span></div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Teacher.html#a2a21915f2270b76ba0e99137d506af89">epochDone</a> = <span class="keyword">False</span></div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        <span class="keywordflow">if</span> batch_idx &gt;= len(self.batches):</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            <span class="keywordflow">return</span> [{<span class="stringliteral">&#39;episode_done&#39;</span>: <span class="keyword">True</span>, <span class="stringliteral">&#39;id&#39;</span>: self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Agent.html#a29e1cdd729ac4236f8bae90b2e66fa04">getID</a>()}] * self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a2f6069ff207d360edf2729c245ceaa0f">bsz</a></div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;        <span class="keywordflow">return</span> self.batches[batch_idx]</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;</div><div class="line"><a name="l00317"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a51e3463e7b7b44a6ea8b43fc82aacb75">  317</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a51e3463e7b7b44a6ea8b43fc82aacb75">num_episodes</a>(self):</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Get the number of episodes in this dataset.&quot;&quot;&quot;</span></div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a8a551d24fa77a0eb880cbee90b507f7e">use_batch_act</a>:</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="comment"># when using batch_act, this is length of sorted data</span></div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <span class="keywordflow">return</span> len(self.sorted_data)</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="keywordflow">raise</span> RuntimeError(<span class="stringliteral">&#39;&quot;num_episodes&quot; must be overriden by children.&#39;</span>)</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;</div><div class="line"><a name="l00324"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a428d3fb5cc710cea78e9cf5a4887aa06">  324</a></span>&#160;    @lru_cache(maxsize=1)</div><div class="line"><a name="l00325"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a38bd0d5c98506c45eb87d6db32d1c0bf">  325</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a38bd0d5c98506c45eb87d6db32d1c0bf">num_examples</a>(self):</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Get the total number of examples in this dataset.&quot;&quot;&quot;</span></div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a8a551d24fa77a0eb880cbee90b507f7e">use_batch_act</a>:</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <span class="comment"># when using batch_act, this is length of sorted data</span></div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <span class="keywordflow">return</span> len(self.sorted_data)</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordflow">raise</span> RuntimeError(<span class="stringliteral">&#39;&quot;num_examples&quot; must be overriden by children.&#39;</span>)</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7c4cbfbe5cf6e9dbdf8c00d140ef4e7e">  332</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7c4cbfbe5cf6e9dbdf8c00d140ef4e7e">get</a>(self, episode_idx, entry_idx=0):</div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="stringliteral">        Get the specified episode and the specified entry in that episode.</span></div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="stringliteral">        Children must override this method in order to inherit the</span></div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="stringliteral">        `next_example` method.</span></div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="stringliteral">        :param episode_idx:</span></div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="stringliteral">            which episode to return examples from</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="stringliteral">        :param entry_idx:</span></div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="stringliteral">            which example to return from the episode.  Many datasets have only</span></div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="stringliteral">            single-entry episodes, so this defaults to zero.</span></div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        <span class="comment"># TODO: mark as abstract, get rid of runtime error.</span></div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;        <span class="keywordflow">raise</span> RuntimeError(<span class="stringliteral">&#39;&quot;Get&quot; method must be overriden by children.&#39;</span>)</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a32febe29909f7523b0d7b5ee7335fd05">  348</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a32febe29909f7523b0d7b5ee7335fd05">observe</a>(self, observation):</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Process observation for metrics.&quot;&quot;&quot;</span></div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a8a551d24fa77a0eb880cbee90b507f7e">use_batch_act</a>:</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#abf7e9a8868478220ca4df71dadeed4a9">lastY</a> = self.lastYs[self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a468d55710137a42b18f85212d7068c47">batchindex</a>]</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            self.lastYs[self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a468d55710137a42b18f85212d7068c47">batchindex</a>] = <span class="keywordtype">None</span></div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        <span class="keywordflow">if</span> hasattr(self, <span class="stringliteral">&#39;lastY&#39;</span>) <span class="keywordflow">and</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#abf7e9a8868478220ca4df71dadeed4a9">lastY</a> <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Teacher.html#a159705efe2a9f389d8adfdad76891f08">metrics</a>.update(observation, self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#abf7e9a8868478220ca4df71dadeed4a9">lastY</a>)</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#abf7e9a8868478220ca4df71dadeed4a9">lastY</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        <span class="keywordflow">return</span> observation</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;</div><div class="line"><a name="l00359"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#afa75426a7578e8aad5b74964219345be">  359</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#afa75426a7578e8aad5b74964219345be">batch_act</a>(self, observations):</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;<span class="stringliteral">        Return an entire batch of examples.</span></div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;<span class="stringliteral">        Note: Currently used by PytorchDataTeacher.</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        <span class="comment"># DEPRECATEDAY: looks like this isn&#39;t used anymore</span></div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;        <span class="comment"># we ignore observations</span></div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasattr(self, <span class="stringliteral">&#39;epochDone&#39;</span>):</div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            <span class="comment"># reset if haven&#39;t yet</span></div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Agent.html#a27cb8206372681605b00dc28b81a7c39">reset</a>()</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        batch = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a49100faf9af79c6e24ddac9e36151d54">next_batch</a>()</div><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        <span class="comment"># pad batch</span></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;        <span class="keywordflow">if</span> len(batch) &lt; self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a2f6069ff207d360edf2729c245ceaa0f">bsz</a>:</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            batch += [{<span class="stringliteral">&#39;episode_done&#39;</span>: <span class="keyword">True</span>, <span class="stringliteral">&#39;id&#39;</span>: self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Agent.html#a29e1cdd729ac4236f8bae90b2e66fa04">getID</a>()}] * (</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a2f6069ff207d360edf2729c245ceaa0f">bsz</a> - len(batch)</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            )</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        <span class="comment"># remember correct answer if available (for padding, None)</span></div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <span class="keywordflow">for</span> i, ex <span class="keywordflow">in</span> enumerate(batch):</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;labels&#39;</span> <span class="keywordflow">in</span> ex:</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                labels = ex[<span class="stringliteral">&#39;labels&#39;</span>]</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                self.lastYs[i] = labels</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a65c9039b783299ad6033ccbb995ca493">datatype</a>.startswith(<span class="stringliteral">&#39;train&#39;</span>) <span class="keywordflow">or</span> <span class="stringliteral">&#39;evalmode&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a65c9039b783299ad6033ccbb995ca493">datatype</a>:</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                    del ex[<span class="stringliteral">&#39;labels&#39;</span>]</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                    <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Agent.html#ab3b45d2754244608c75d4068b90cd051">opt</a>.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7c4cbfbe5cf6e9dbdf8c00d140ef4e7e">get</a>(<span class="stringliteral">&#39;hide_labels&#39;</span>, <span class="keyword">False</span>):</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                        ex[<span class="stringliteral">&#39;eval_labels&#39;</span>] = labels</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                self.lastYs[i] = ex.get(<span class="stringliteral">&#39;eval_labels&#39;</span>, <span class="keywordtype">None</span>)</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keywordflow">return</span> batch</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div><div class="line"><a name="l00392"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a759b2dcb341b657fda29c71a7a5354b4">  392</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a759b2dcb341b657fda29c71a7a5354b4">act</a>(self):</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Send new dialog message.&quot;&quot;&quot;</span></div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasattr(self, <span class="stringliteral">&#39;epochDone&#39;</span>):</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            <span class="comment"># reset if haven&#39;t yet</span></div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Agent.html#a27cb8206372681605b00dc28b81a7c39">reset</a>()</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;        <span class="comment"># get next example, action is episode_done dict if already out of exs</span></div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;        action, self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Teacher.html#a2a21915f2270b76ba0e99137d506af89">epochDone</a> = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#aa6782a610b00aa0675522aa58b03f20c">next_example</a>()</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="comment"># TODO: all teachers should eventually create messages</span></div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <span class="comment"># while setting up the data, so this won&#39;t be necessary</span></div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        action = <a class="code" href="classparlai_1_1core_1_1message_1_1Message.html">Message</a>(action)</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;        action.force_set(<span class="stringliteral">&#39;id&#39;</span>, self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Agent.html#a29e1cdd729ac4236f8bae90b2e66fa04">getID</a>())</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        <span class="comment"># remember correct answer if available</span></div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#abf7e9a8868478220ca4df71dadeed4a9">lastY</a> = action.get(<span class="stringliteral">&#39;labels&#39;</span>, action.get(<span class="stringliteral">&#39;eval_labels&#39;</span>, <span class="keywordtype">None</span>))</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        <span class="keywordflow">if</span> (</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <span class="keywordflow">not</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a65c9039b783299ad6033ccbb995ca493">datatype</a>.startswith(<span class="stringliteral">&#39;train&#39;</span>) <span class="keywordflow">or</span> <span class="stringliteral">&#39;evalmode&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a65c9039b783299ad6033ccbb995ca493">datatype</a></div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        ) <span class="keywordflow">and</span> <span class="stringliteral">&#39;labels&#39;</span> <span class="keywordflow">in</span> action:</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            <span class="comment"># move labels to eval field so not used for training</span></div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            <span class="comment"># but this way the model can use the labels for perplexity or loss</span></div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            action = action.copy()</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            labels = action.pop(<span class="stringliteral">&#39;labels&#39;</span>)</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Agent.html#ab3b45d2754244608c75d4068b90cd051">opt</a>.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7c4cbfbe5cf6e9dbdf8c00d140ef4e7e">get</a>(<span class="stringliteral">&#39;hide_labels&#39;</span>, <span class="keyword">False</span>):</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                action[<span class="stringliteral">&#39;eval_labels&#39;</span>] = labels</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;</div><div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        <span class="keywordflow">return</span> action</div><div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div><div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div><div class="line"><a name="l00420"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html">  420</a></span>&#160;<span class="keyword">class </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html">DialogTeacher</a>(<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html">FixedDialogTeacher</a>):</div><div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;<span class="stringliteral">    A base teacher class for doing dialog with fixed chat logs.</span></div><div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;<span class="stringliteral">    This class provides a set a basic functionality:</span></div><div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="stringliteral">    - uses data class to store and query text data</span></div><div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;<span class="stringliteral">    - generates action tables to send to the student agent from the data</span></div><div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;<span class="stringliteral">    If you have ``opt.numthreads &gt; 1``, this also activates a shared memory</span></div><div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;<span class="stringliteral">    array for the data and lock-protected shared-memory metrics.</span></div><div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="stringliteral">    In order to subclass this class, you must implement ``setup_data()`` in</span></div><div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;<span class="stringliteral">    your class (or subclass another class which does, like</span></div><div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="stringliteral">    ``FbDialogTeacher``), which reads your data file as an iterator.</span></div><div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div><div class="line"><a name="l00437"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a9385b9ae914ef84be6b54107811b202b">  437</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a9385b9ae914ef84be6b54107811b202b">__init__</a>(self, opt, shared=None):</div><div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;        <span class="comment"># Check for setup_data</span></div><div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> hasattr(self, <span class="stringliteral">&#39;setup_data&#39;</span>):</div><div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;            <span class="keywordflow">raise</span> RuntimeError(</div><div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                <span class="stringliteral">&#39;Must implement setup_data or subclass a class &#39;</span></div><div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                <span class="stringliteral">&#39;which implements it (e.g. FbDialogTeacher) &#39;</span></div><div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                <span class="stringliteral">&#39;in order to use this class.&#39;</span></div><div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;            )</div><div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;        super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a9385b9ae914ef84be6b54107811b202b">__init__</a>(opt, shared)</div><div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div><div class="line"><a name="l00447"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a8dc7153ce190442ad5d35b255389bf5a">  447</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a8dc7153ce190442ad5d35b255389bf5a">startTime</a> = time.time()</div><div class="line"><a name="l00448"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a4bd247f78e23331700e150991d0afdba">  448</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a65c9039b783299ad6033ccbb995ca493">datatype</a> = opt[<span class="stringliteral">&#39;datatype&#39;</span>]</div><div class="line"><a name="l00449"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#aaca26d863c30e54b4612539843f20b49">  449</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#af64b55521fe587c17696b0b805a2b0d4">training</a> = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a65c9039b783299ad6033ccbb995ca493">datatype</a>.startswith(<span class="stringliteral">&#39;train&#39;</span>)</div><div class="line"><a name="l00450"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a82fa5b519a14c4301ce82f6c59c8867a">  450</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a82fa5b519a14c4301ce82f6c59c8867a">stream</a> = <span class="stringliteral">&#39;stream&#39;</span> <span class="keywordflow">in</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a65c9039b783299ad6033ccbb995ca493">datatype</a>.split(<span class="stringliteral">&#39;:&#39;</span>)</div><div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;</div><div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a8a551d24fa77a0eb880cbee90b507f7e">use_batch_act</a>:</div><div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;            <span class="comment"># first initialize any shared objects</span></div><div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            data_class = StreamDialogData <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a82fa5b519a14c4301ce82f6c59c8867a">stream</a> <span class="keywordflow">else</span> DialogData</div><div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            kwargs = {<span class="stringliteral">&#39;cycle&#39;</span>: self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#af64b55521fe587c17696b0b805a2b0d4">training</a>} <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a82fa5b519a14c4301ce82f6c59c8867a">stream</a> <span class="keywordflow">else</span> {}</div><div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;            <span class="keywordflow">if</span> shared <span class="keywordflow">and</span> shared.get(<span class="stringliteral">&#39;data&#39;</span>):</div><div class="line"><a name="l00457"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a6089018ef23e5f55862292d25628e6a5">  457</a></span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a6089018ef23e5f55862292d25628e6a5">data</a> = data_class(opt, shared=shared[<span class="stringliteral">&#39;data&#39;</span>], **kwargs)</div><div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a6089018ef23e5f55862292d25628e6a5">data</a> = data_class(</div><div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                    opt,</div><div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                    data_loader=self.setup_data,</div><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                    cands=self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a50649105cc9d00bcaa860290d804eac9">label_candidates</a>(),</div><div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                    **kwargs,</div><div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                )</div><div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;</div><div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Agent.html#a27cb8206372681605b00dc28b81a7c39">reset</a>()</div><div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;</div><div class="line"><a name="l00468"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a393f94ea28e1733f575a9f36a0b43c18">  468</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a393f94ea28e1733f575a9f36a0b43c18">reset</a>(self):</div><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Reset the dialog to the start of the epoch, reset all metrics.&quot;&quot;&quot;</span></div><div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;        super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a393f94ea28e1733f575a9f36a0b43c18">reset</a>()</div><div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a82fa5b519a14c4301ce82f6c59c8867a">stream</a>:</div><div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a6089018ef23e5f55862292d25628e6a5">data</a>.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a393f94ea28e1733f575a9f36a0b43c18">reset</a>()</div><div class="line"><a name="l00473"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a9e2cd457217253ef6d3aa0b23418739b">  473</a></span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Teacher.html#a2a21915f2270b76ba0e99137d506af89">epochDone</a> = <span class="keyword">False</span></div><div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;</div><div class="line"><a name="l00475"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a55fc9dead757489e127ec1a872849376">  475</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a55fc9dead757489e127ec1a872849376">share</a>(self):</div><div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Share the data.&quot;&quot;&quot;</span></div><div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;        shared = super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a55fc9dead757489e127ec1a872849376">share</a>()</div><div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;        <span class="keywordflow">if</span> hasattr(self, <span class="stringliteral">&#39;data&#39;</span>):</div><div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;            shared[<span class="stringliteral">&#39;data&#39;</span>] = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a6089018ef23e5f55862292d25628e6a5">data</a>.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a55fc9dead757489e127ec1a872849376">share</a>()</div><div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="keywordflow">return</span> shared</div><div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;</div><div class="line"><a name="l00482"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a50649105cc9d00bcaa860290d804eac9">  482</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a50649105cc9d00bcaa860290d804eac9">label_candidates</a>(self):</div><div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="stringliteral">        Provide consistent label candidates for all examples.</span></div><div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="stringliteral">        Default implementation returns ``None`` always, but this may be overriden</span></div><div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="stringliteral">        to provide candidates in all areas. See ``FbDialogueTeacher``.</span></div><div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <span class="comment"># TODO DEPRECATIONDAY: FbiDialogueTeacher is being deprecated, should we</span></div><div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        <span class="comment"># remove this?</span></div><div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;</div><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;        <span class="comment"># TODO: mark as optionally abstract?</span></div><div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;        <span class="keywordflow">return</span> <span class="keywordtype">None</span></div><div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;</div><div class="line"><a name="l00495"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#af1e90a07058dc489c45280f0982e21be">  495</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#af1e90a07058dc489c45280f0982e21be">num_episodes</a>(self):</div><div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Return the number of episodes in the data.&quot;&quot;&quot;</span></div><div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a6089018ef23e5f55862292d25628e6a5">data</a>.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#af1e90a07058dc489c45280f0982e21be">num_episodes</a>()</div><div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;        <span class="keywordflow">except</span> AttributeError:</div><div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            <span class="keywordflow">return</span> super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#af1e90a07058dc489c45280f0982e21be">num_episodes</a>()</div><div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div><div class="line"><a name="l00502"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#aa0637cf3392baf2e9c965de7ffc812ac">  502</a></span>&#160;    @lru_cache(maxsize=1)</div><div class="line"><a name="l00503"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#ad90c8cac27f2db22db77e29828b94dfe">  503</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#ad90c8cac27f2db22db77e29828b94dfe">num_examples</a>(self):</div><div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Return the number of examples in the data.&quot;&quot;&quot;</span></div><div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;        <span class="keywordflow">try</span>:</div><div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a6089018ef23e5f55862292d25628e6a5">data</a>.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#ad90c8cac27f2db22db77e29828b94dfe">num_examples</a>()</div><div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        <span class="keywordflow">except</span> AttributeError:</div><div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            <span class="keywordflow">return</span> super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#ad90c8cac27f2db22db77e29828b94dfe">num_examples</a>()</div><div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;</div><div class="line"><a name="l00510"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a1988d984bf87370e9a9e58c9b8ca67a8">  510</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a1988d984bf87370e9a9e58c9b8ca67a8">get</a>(self, episode_idx, entry_idx=0):</div><div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Get a specific example.&quot;&quot;&quot;</span></div><div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a6089018ef23e5f55862292d25628e6a5">data</a>.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a1988d984bf87370e9a9e58c9b8ca67a8">get</a>(episode_idx, entry_idx)[0]</div><div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;</div><div class="line"><a name="l00514"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a738c4571db2fee7ce3ab01072f10ed49">  514</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a738c4571db2fee7ce3ab01072f10ed49">next_example</a>(self):</div><div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Get the next example.&quot;&quot;&quot;</span></div><div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a82fa5b519a14c4301ce82f6c59c8867a">stream</a>:</div><div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            action, epoch_done = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a6089018ef23e5f55862292d25628e6a5">data</a>.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a1988d984bf87370e9a9e58c9b8ca67a8">get</a>()</div><div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            action, epoch_done = super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a738c4571db2fee7ce3ab01072f10ed49">next_example</a>()</div><div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <span class="keywordflow">return</span> action, epoch_done</div><div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;</div><div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;</div><div class="line"><a name="l00523"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogData.html">  523</a></span>&#160;<span class="keyword">class </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html">DialogData</a>(object):</div><div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="stringliteral">    Provides a data structure for accessing textual dialog data.</span></div><div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="stringliteral">    This can be used whenever the dialog data is a fixed log of chats</span></div><div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="stringliteral">    (i.e not a simulator setting). The logs can include dialog text and possibly</span></div><div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="stringliteral">    supervised labels, candidate labels and rewards.</span></div><div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="stringliteral">    All these are stored in this internal data format which is used by the</span></div><div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="stringliteral">    ``DialogTeacher`` class.</span></div><div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="stringliteral">    :param opt:</span></div><div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="stringliteral">        options to initialize the class</span></div><div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="stringliteral">    :param data_loader:</span></div><div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="stringliteral">        an iterable with each call returning a tuple in the form</span></div><div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="stringliteral">        ``((x, y, r, c, i), new_episode?)`` where the ``x`` and ``new_episode``</span></div><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="stringliteral">        fields are mandatory and other fields may be omitted or ``None``.</span></div><div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="stringliteral">    :param cands:</span></div><div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="stringliteral">        can be set to provide a list of candidate labels for every example in</span></div><div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="stringliteral">        this dataset, which the agent can choose from (the correct answer</span></div><div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="stringliteral">        should be in this set).</span></div><div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="stringliteral">    :param random:</span></div><div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="stringliteral">        tells the data class whether or not to visit episodes sequentially or</span></div><div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="stringliteral">        randomly when returning examples to the caller.</span></div><div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="stringliteral">    The contents of the ``((x, y, r, c, i), new_episode?)`` tuples returned by</span></div><div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="stringliteral">    the data loader is the following:</span></div><div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="stringliteral">    - ``x`` (str) is a query and possibly context</span></div><div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="stringliteral">    - ``y`` (iter) is an iterable of label(s) for that query</span></div><div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="stringliteral">    - ``r`` (str) is the str reward for getting that query correct</span></div><div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="stringliteral">    - ``c`` (iter) is an iterable of label candidates that the student can choose from</span></div><div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="stringliteral">    - ``i`` (str) is a str path to an image on disk, which will be loaded by the</span></div><div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="stringliteral">      data class at request-time. should always point to the raw image file.</span></div><div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="stringliteral">    - ``new_episode?`` (bool) is a boolean value specifying whether that example</span></div><div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="stringliteral">      is the start of a new episode. If you don&#39;t use episodes set this</span></div><div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="stringliteral">      to ``True`` every time.</span></div><div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;</div><div class="line"><a name="l00563"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a8c20c97b259bf583c53f47d235790813">  563</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a8c20c97b259bf583c53f47d235790813">__init__</a>(self, opt, data_loader=None, cands=None, shared=None, **kwargs):</div><div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;        <span class="comment"># self.data is a list of episodes</span></div><div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;        <span class="comment"># each episode is a tuple of entries</span></div><div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;        <span class="comment"># each entry is a tuple of values for the action/observation table</span></div><div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <span class="keywordflow">if</span> shared:</div><div class="line"><a name="l00568"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#aa44f9307c376a1e4bf4697a289db688b">  568</a></span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#aa44f9307c376a1e4bf4697a289db688b">image_loader</a> = shared.get(<span class="stringliteral">&#39;image_loader&#39;</span>, <span class="keywordtype">None</span>)</div><div class="line"><a name="l00569"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a4acc939bddc7bf81f0e19ae9fa9f197a">  569</a></span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a4acc939bddc7bf81f0e19ae9fa9f197a">data</a> = shared.get(<span class="stringliteral">&#39;data&#39;</span>, [])</div><div class="line"><a name="l00570"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a21822d2d86e26a27bdc8326b48ebc9b9">  570</a></span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a21822d2d86e26a27bdc8326b48ebc9b9">cands</a> = shared.get(<span class="stringliteral">&#39;cands&#39;</span>, <span class="keywordtype">None</span>)</div><div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#aa44f9307c376a1e4bf4697a289db688b">image_loader</a> = <a class="code" href="classparlai_1_1core_1_1image__featurizers_1_1ImageLoader.html">ImageLoader</a>(opt)</div><div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a4acc939bddc7bf81f0e19ae9fa9f197a">data</a> = []</div><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#ad57a8129b3109fec84d99de56813b524">_load</a>(data_loader, opt[<span class="stringliteral">&#39;datafile&#39;</span>])</div><div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a21822d2d86e26a27bdc8326b48ebc9b9">cands</a> = <span class="keywordtype">None</span> <span class="keywordflow">if</span> cands <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">else</span> set(sys.intern(c) <span class="keywordflow">for</span> c <span class="keywordflow">in</span> cands)</div><div class="line"><a name="l00576"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#aee61e6bc9e80fe0443a7f5322c4ae08d">  576</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#aee61e6bc9e80fe0443a7f5322c4ae08d">addedCands</a> = []</div><div class="line"><a name="l00577"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a25f9100e2b36edf74528a60533e728e4">  577</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a25f9100e2b36edf74528a60533e728e4">copied_cands</a> = <span class="keyword">False</span></div><div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;</div><div class="line"><a name="l00579"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#ada6f4dc4e2a8a84fba5f1e54d214d15e">  579</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#ada6f4dc4e2a8a84fba5f1e54d214d15e">share</a>(self):</div><div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Share the data.&quot;&quot;&quot;</span></div><div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        shared = {</div><div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            <span class="stringliteral">&#39;data&#39;</span>: self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a4acc939bddc7bf81f0e19ae9fa9f197a">data</a>,</div><div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            <span class="stringliteral">&#39;cands&#39;</span>: self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a21822d2d86e26a27bdc8326b48ebc9b9">cands</a>,</div><div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            <span class="stringliteral">&#39;image_loader&#39;</span>: self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#aa44f9307c376a1e4bf4697a289db688b">image_loader</a>,</div><div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;        }</div><div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;        <span class="keywordflow">return</span> shared</div><div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;</div><div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    <span class="keyword">def </span>_read_episode(self, data_loader):</div><div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="stringliteral">        Read one episode at a time from the provided iterable over entries.</span></div><div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="stringliteral">        :param data_loader:</span></div><div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="stringliteral">            an iterable which returns tuples in the format described in the</span></div><div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="stringliteral">            class docstring.</span></div><div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        episode = []</div><div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        last_cands = <span class="keywordtype">None</span></div><div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keywordflow">for</span> entry, new <span class="keywordflow">in</span> data_loader:</div><div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            <span class="keywordflow">if</span> new <span class="keywordflow">and</span> len(episode) &gt; 0:</div><div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                <span class="keywordflow">yield</span> tuple(episode)</div><div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                episode = []</div><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                last_cands = <span class="keywordtype">None</span></div><div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;</div><div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            <span class="comment"># intern all strings so we don&#39;t store them more than once</span></div><div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            <span class="comment"># TODO: clean up the if .. sys.intern else None by refactoring</span></div><div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            new_entry = []</div><div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            <span class="keywordflow">if</span> len(entry) &gt; 0:</div><div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                <span class="comment"># process text if available</span></div><div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                <span class="keywordflow">if</span> entry[0] <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                    new_entry.append(sys.intern(entry[0]))</div><div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                    new_entry.append(<span class="keywordtype">None</span>)</div><div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                <span class="comment"># TODO: unindent all of these one level.</span></div><div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                <span class="keywordflow">if</span> len(entry) &gt; 1:</div><div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                    <span class="comment"># process labels if available</span></div><div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                    <span class="keywordflow">if</span> entry[1] <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;                        new_entry.append(<span class="keywordtype">None</span>)</div><div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                    <span class="keywordflow">elif</span> hasattr(entry[1], <span class="stringliteral">&#39;__iter__&#39;</span>) <span class="keywordflow">and</span> <a class="code" href="namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf.html#ad5dfae268e23f506da084a9efb72f619">type</a>(entry[1]) <span class="keywordflow">is</span> <span class="keywordflow">not</span> str:</div><div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                        <span class="comment"># TODO: this could use the abc collections</span></div><div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                        <span class="comment"># make sure iterable over labels, not single string</span></div><div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;                        new_entry.append(tuple(sys.intern(e) <span class="keywordflow">for</span> e <span class="keywordflow">in</span> entry[1]))</div><div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;                        <span class="keywordflow">raise</span> TypeError(</div><div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                            <span class="stringliteral">&#39;Must provide iterable over labels, not a single string.&#39;</span></div><div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;                        )</div><div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;                <span class="keywordflow">if</span> len(entry) &gt; 2:</div><div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;                    <span class="comment"># process reward if available</span></div><div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;                    <span class="keywordflow">if</span> entry[2] <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                        new_entry.append(entry[2])</div><div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                        new_entry.append(<span class="keywordtype">None</span>)</div><div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                <span class="keywordflow">if</span> len(entry) &gt; 3:</div><div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                    <span class="comment"># process label candidates if available</span></div><div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                    <span class="keywordflow">if</span> entry[3] <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                        new_entry.append(<span class="keywordtype">None</span>)</div><div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                    <span class="keywordflow">elif</span> last_cands <span class="keywordflow">and</span> entry[3] <span class="keywordflow">is</span> last_cands:</div><div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                        <span class="comment"># if cands are shared, say &quot;same&quot; so we</span></div><div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;                        <span class="comment"># don&#39;t store them again</span></div><div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;                        <span class="comment"># TODO: This is bad, and it&#39;s not actually used anywhere</span></div><div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                        <span class="comment"># DEPRECATIONDAY: make this more rational</span></div><div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                        new_entry.append(sys.intern(<span class="stringliteral">&#39;same as last time&#39;</span>))</div><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                    <span class="keywordflow">elif</span> hasattr(entry[3], <span class="stringliteral">&#39;__iter__&#39;</span>) <span class="keywordflow">and</span> <a class="code" href="namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf.html#ad5dfae268e23f506da084a9efb72f619">type</a>(entry[3]) <span class="keywordflow">is</span> <span class="keywordflow">not</span> str:</div><div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                        <span class="comment"># make sure iterable over candidates, not single string</span></div><div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                        last_cands = entry[3]</div><div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;                        new_entry.append(tuple(sys.intern(e) <span class="keywordflow">for</span> e <span class="keywordflow">in</span> entry[3]))</div><div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;                        <span class="keywordflow">raise</span> TypeError(</div><div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;                            <span class="stringliteral">&#39;Must provide iterable over label candidates, &#39;</span></div><div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;                            <span class="stringliteral">&#39;not a single string.&#39;</span></div><div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;                        )</div><div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                <span class="keywordflow">if</span> len(entry) &gt; 4 <span class="keywordflow">and</span> entry[4] <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                    new_entry.append(sys.intern(entry[4]))</div><div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;</div><div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;            episode.append(tuple(new_entry))</div><div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;</div><div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <span class="keywordflow">if</span> len(episode) &gt; 0:</div><div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;            <span class="keywordflow">yield</span> tuple(episode)</div><div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;</div><div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <span class="keyword">def </span>_load(self, data_loader, datafile):</div><div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;<span class="stringliteral">        Load up data from an iterable over tuples described in the class docs.</span></div><div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="stringliteral">        :param iter data_loader:</span></div><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;<span class="stringliteral">            an iterator which returns tuples in the format described in the</span></div><div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;<span class="stringliteral">            class docstring.</span></div><div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;<span class="stringliteral">        :param str datafile:</span></div><div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        <span class="keywordflow">for</span> episode <span class="keywordflow">in</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#abd563ce3d2e4c105b06a30ef9895c51b">_read_episode</a>(data_loader(datafile)):</div><div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a4acc939bddc7bf81f0e19ae9fa9f197a">data</a>.append(episode)</div><div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;</div><div class="line"><a name="l00671"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a83e3457f29a54ec455ad76f7eab6cfc4">  671</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a83e3457f29a54ec455ad76f7eab6cfc4">num_episodes</a>(self):</div><div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Return number of episodes in the dataset.&quot;&quot;&quot;</span></div><div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        <span class="keywordflow">return</span> len(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a4acc939bddc7bf81f0e19ae9fa9f197a">data</a>)</div><div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div><div class="line"><a name="l00675"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a9c25f1914274bbc5b6aeae335e98957a">  675</a></span>&#160;    @lru_cache(maxsize=1)</div><div class="line"><a name="l00676"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a8deee9e9e45ae8162270bdcdfd7916b6">  676</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a8deee9e9e45ae8162270bdcdfd7916b6">num_examples</a>(self):</div><div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;<span class="stringliteral">        Return total number of entries available.</span></div><div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;<span class="stringliteral">        Each episode has at least one entry, but might have many more.</span></div><div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;        <span class="keywordflow">return</span> sum(len(episode) <span class="keywordflow">for</span> episode <span class="keywordflow">in</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a4acc939bddc7bf81f0e19ae9fa9f197a">data</a>)</div><div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;</div><div class="line"><a name="l00684"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a1e037df2f18a67503db657ae4cc27ab4">  684</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a1e037df2f18a67503db657ae4cc27ab4">get</a>(self, episode_idx, entry_idx=0):</div><div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;<span class="stringliteral">        Get the specified episode and the specified entry in that episode.</span></div><div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;<span class="stringliteral">        :param episode_idx:</span></div><div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="stringliteral">            which episode to return examples from</span></div><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;<span class="stringliteral">        :param entry_idx:</span></div><div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="stringliteral">            which example to return from the episode. Many datasets have only</span></div><div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;<span class="stringliteral">            single-entry episodes, so this defaults to zero.</span></div><div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        <span class="comment"># first look up data</span></div><div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;        episode = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a4acc939bddc7bf81f0e19ae9fa9f197a">data</a>[episode_idx]</div><div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;        entry = episode[entry_idx]</div><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        episode_done = entry_idx == len(episode) - 1</div><div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        end_of_data = episode_done <span class="keywordflow">and</span> episode_idx == len(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a4acc939bddc7bf81f0e19ae9fa9f197a">data</a>) - 1</div><div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;</div><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <span class="comment"># now pack it in a action-observation dictionary</span></div><div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        table = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a467bf261c35da2f5d2a34949281d2669">build_table</a>(entry)</div><div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;</div><div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <span class="comment"># last entry in this episode</span></div><div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        table[<span class="stringliteral">&#39;episode_done&#39;</span>] = episode_done</div><div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;        <span class="keywordflow">return</span> table, end_of_data</div><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;</div><div class="line"><a name="l00707"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a467bf261c35da2f5d2a34949281d2669">  707</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a467bf261c35da2f5d2a34949281d2669">build_table</a>(self, entry):</div><div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="stringliteral">        Packs an entry into an action-observation dictionary.</span></div><div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;<span class="stringliteral">        :param entry: a tuple in the form described in the class docstring.</span></div><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;        table = {}</div><div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        <span class="keywordflow">if</span> entry[0] <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            table[<span class="stringliteral">&#39;text&#39;</span>] = entry[0]</div><div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;        <span class="keywordflow">if</span> len(entry) &gt; 1:</div><div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            <span class="keywordflow">if</span> entry[1] <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;                table[<span class="stringliteral">&#39;labels&#39;</span>] = entry[1]</div><div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;        <span class="keywordflow">if</span> len(entry) &gt; 2:</div><div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            <span class="keywordflow">if</span> entry[2] <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;                table[<span class="stringliteral">&#39;reward&#39;</span>] = entry[2]</div><div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        <span class="keywordflow">if</span> len(entry) &gt; 3:</div><div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            <span class="keywordflow">if</span> entry[3] <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                table[<span class="stringliteral">&#39;label_candidates&#39;</span>] = entry[3]</div><div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <span class="keywordflow">if</span> len(entry) &gt; 4 <span class="keywordflow">and</span> entry[4] <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;            img = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#aa44f9307c376a1e4bf4697a289db688b">image_loader</a>.load(entry[4])</div><div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;            <span class="keywordflow">if</span> img <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;                table[<span class="stringliteral">&#39;image&#39;</span>] = img</div><div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;</div><div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        <span class="keywordflow">if</span> table.get(<span class="stringliteral">&#39;labels&#39;</span>, <span class="keywordtype">None</span>) <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span> <span class="keywordflow">and</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a21822d2d86e26a27bdc8326b48ebc9b9">cands</a> <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#aee61e6bc9e80fe0443a7f5322c4ae08d">addedCands</a>:</div><div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                <span class="comment"># remove elements in addedCands</span></div><div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a21822d2d86e26a27bdc8326b48ebc9b9">cands</a>.difference_update(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#aee61e6bc9e80fe0443a7f5322c4ae08d">addedCands</a>)</div><div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#aee61e6bc9e80fe0443a7f5322c4ae08d">addedCands</a>.clear()</div><div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;            <span class="keywordflow">for</span> label <span class="keywordflow">in</span> table[<span class="stringliteral">&#39;labels&#39;</span>]:</div><div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;                <span class="keywordflow">if</span> label <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a21822d2d86e26a27bdc8326b48ebc9b9">cands</a>:</div><div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;                    <span class="comment"># add labels, queue them for removal next time</span></div><div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;                    <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a25f9100e2b36edf74528a60533e728e4">copied_cands</a>:</div><div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a21822d2d86e26a27bdc8326b48ebc9b9">cands</a> = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a21822d2d86e26a27bdc8326b48ebc9b9">cands</a>.copy()</div><div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a25f9100e2b36edf74528a60533e728e4">copied_cands</a> = <span class="keyword">True</span></div><div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                    self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a21822d2d86e26a27bdc8326b48ebc9b9">cands</a>.add(label)</div><div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;                    self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#aee61e6bc9e80fe0443a7f5322c4ae08d">addedCands</a>.append(label)</div><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            table[<span class="stringliteral">&#39;label_candidates&#39;</span>] = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a21822d2d86e26a27bdc8326b48ebc9b9">cands</a></div><div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;</div><div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="keywordflow">if</span> <span class="stringliteral">&#39;labels&#39;</span> <span class="keywordflow">in</span> table <span class="keywordflow">and</span> <span class="stringliteral">&#39;label_candidates&#39;</span> <span class="keywordflow">in</span> table:</div><div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;            <span class="keywordflow">if</span> table[<span class="stringliteral">&#39;labels&#39;</span>][0] <span class="keywordflow">not</span> <span class="keywordflow">in</span> table[<span class="stringliteral">&#39;label_candidates&#39;</span>]:</div><div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                <span class="keywordflow">raise</span> RuntimeError(<span class="stringliteral">&#39;true label missing from candidate labels&#39;</span>)</div><div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;        <span class="keywordflow">return</span> table</div><div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;</div><div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;</div><div class="line"><a name="l00751"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html">  751</a></span>&#160;<span class="keyword">class </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html">StreamDialogData</a>(<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html">DialogData</a>):</div><div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;<span class="stringliteral">    Provides a data structure for streaming textual dialog data.</span></div><div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;<span class="stringliteral">    This can be used whenever the dialog data follows the format described in</span></div><div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="stringliteral">    DialogData but cannot fit entirely into memory.</span></div><div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;<span class="stringliteral">    Additional keyword-argument cycle defines if the stream should restart from</span></div><div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;<span class="stringliteral">    the beginning after an epoch is finished (defaults to True).</span></div><div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;<span class="stringliteral">    :param opt:</span></div><div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;<span class="stringliteral">        options to initialize the class</span></div><div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;<span class="stringliteral">    :param data_loader:</span></div><div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;<span class="stringliteral">        an iterable with each call returning a tuple in the form</span></div><div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;<span class="stringliteral">        ``((x, y, r, c, i), new_episode?)`` where the ``x`` and ``new_episode``</span></div><div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;<span class="stringliteral">        fields are mandatory and other fields may be omitted or ``None``.</span></div><div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;<span class="stringliteral">    :param cands:</span></div><div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;<span class="stringliteral">        can be set to provide a list of candidate labels for every example in</span></div><div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;<span class="stringliteral">        this dataset, which the agent can choose from (the correct answer</span></div><div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="stringliteral">        should be in this set).</span></div><div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="stringliteral">    :param random:</span></div><div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="stringliteral">        tells the data class whether or not to visit episodes sequentially or</span></div><div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="stringliteral">        randomly when returning examples to the caller.</span></div><div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="stringliteral">    :param cycle:</span></div><div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="stringliteral">        (default True) whether to restart at beginning when end of stream</span></div><div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;<span class="stringliteral">        reached without reset being called.</span></div><div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;</div><div class="line"><a name="l00779"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a72324ec2775d16b31d1d18287a8f84e9">  779</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a72324ec2775d16b31d1d18287a8f84e9">__init__</a>(self, opt, data_loader=None, cands=None, shared=None, **kwargs):</div><div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;        <span class="comment"># super() call initiates stream in self.data by calling _load()</span></div><div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;        super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a72324ec2775d16b31d1d18287a8f84e9">__init__</a>(opt, data_loader, cands, shared, **kwargs)</div><div class="line"><a name="l00782"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#af41dd0f335bb24f499376f0b55ebea93">  782</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#af41dd0f335bb24f499376f0b55ebea93">cycle</a> = kwargs[<span class="stringliteral">&#39;cycle&#39;</span>] <span class="keywordflow">if</span> <span class="stringliteral">&#39;cycle&#39;</span> <span class="keywordflow">in</span> kwargs <span class="keywordflow">else</span> <span class="keyword">True</span></div><div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;        <span class="keywordflow">if</span> shared:</div><div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            <span class="comment"># auxiliary instances hold pointer to main datastream in self.data</span></div><div class="line"><a name="l00785"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#ae054596c459b22bbeacf622a5208b785">  785</a></span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#ae054596c459b22bbeacf622a5208b785">reset_data</a> = shared[<span class="stringliteral">&#39;reset&#39;</span>]</div><div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;            <span class="comment"># Share datafile and data_loader for computing num_exs and num_eps</span></div><div class="line"><a name="l00787"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a4c7f45ba690d0533d6a8c5c0235155b2">  787</a></span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a4c7f45ba690d0533d6a8c5c0235155b2">datafile</a> = shared[<span class="stringliteral">&#39;datafile&#39;</span>]</div><div class="line"><a name="l00788"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a35ddb652bb3255dba53d5fd69046ebb7">  788</a></span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a35ddb652bb3255dba53d5fd69046ebb7">data_loader</a> = shared[<span class="stringliteral">&#39;data_loader&#39;</span>]</div><div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;lock&#39;</span> <span class="keywordflow">in</span> shared:</div><div class="line"><a name="l00790"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#adcc1f5f967652688ec8dbcfb3abbcaa6">  790</a></span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#adcc1f5f967652688ec8dbcfb3abbcaa6">lock</a> = shared[<span class="stringliteral">&#39;lock&#39;</span>]</div><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;            <span class="comment"># main instance holds the stream and shares pointer to it</span></div><div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a35ddb652bb3255dba53d5fd69046ebb7">data_loader</a> = data_loader</div><div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a4c7f45ba690d0533d6a8c5c0235155b2">datafile</a> = opt[<span class="stringliteral">&#39;datafile&#39;</span>]</div><div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#ae054596c459b22bbeacf622a5208b785">reset_data</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00796"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a30ca966ffb33e7cbc8f97e9b8837cbc1">  796</a></span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a30ca966ffb33e7cbc8f97e9b8837cbc1">is_reset</a> = <span class="keyword">True</span></div><div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;            <span class="keywordflow">if</span> opt.get(<span class="stringliteral">&#39;numthreads&#39;</span>, 1) &gt; 1:</div><div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                print(</div><div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                    <span class="stringliteral">&#39;WARNING: multithreaded streaming will process every &#39;</span></div><div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                    <span class="stringliteral">&#39;example numthreads times.&#39;</span></div><div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                )</div><div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#adcc1f5f967652688ec8dbcfb3abbcaa6">lock</a> = Lock()</div><div class="line"><a name="l00803"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#af239ccfb38c42707c97eb8575fb82f10">  803</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#af239ccfb38c42707c97eb8575fb82f10">entry_idx</a> = 0</div><div class="line"><a name="l00804"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a40ac215e58913119b1406b1d440a55f4">  804</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a40ac215e58913119b1406b1d440a55f4">next_episode</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00805"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a8f5807d28b1b0a4d7eb09ae287b2c01b">  805</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a8f5807d28b1b0a4d7eb09ae287b2c01b">num_eps</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00806"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a6aa5dc9644a792b801bc7cf69a194ae6">  806</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a6aa5dc9644a792b801bc7cf69a194ae6">num_exs</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;</div><div class="line"><a name="l00808"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a6bb0ef8ed4a3360184f715e8fab9b3aa">  808</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a6bb0ef8ed4a3360184f715e8fab9b3aa">share</a>(self):</div><div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Share the stream.&quot;&quot;&quot;</span></div><div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;        shared = super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a6bb0ef8ed4a3360184f715e8fab9b3aa">share</a>()</div><div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        <span class="comment"># also share reset method to allow datastream to be reset</span></div><div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        shared[<span class="stringliteral">&#39;reset&#39;</span>] = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a6375bd13d685da4b3449caaafcc5ec13">reset</a></div><div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;        <span class="comment"># share datafile and data for loading length if necessary</span></div><div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        shared[<span class="stringliteral">&#39;datafile&#39;</span>] = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a4c7f45ba690d0533d6a8c5c0235155b2">datafile</a></div><div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        shared[<span class="stringliteral">&#39;data_loader&#39;</span>] = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a35ddb652bb3255dba53d5fd69046ebb7">data_loader</a></div><div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;        <span class="keywordflow">if</span> hasattr(self, <span class="stringliteral">&#39;lock&#39;</span>):</div><div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            shared[<span class="stringliteral">&#39;lock&#39;</span>] = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#adcc1f5f967652688ec8dbcfb3abbcaa6">lock</a></div><div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div><div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;        <span class="keywordflow">return</span> shared</div><div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;</div><div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;    <span class="keyword">def </span>_load(self, data_loader, datafile):</div><div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Load data generator into data field.&quot;&quot;&quot;</span></div><div class="line"><a name="l00823"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#ab015e93ae59c4b98f3f9dd883f6f07b2">  823</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a4acc939bddc7bf81f0e19ae9fa9f197a">data</a> = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a208467ba7e999efaf5d1d39ef3c060ff">_data_generator</a>(data_loader, datafile)</div><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;</div><div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keyword">def </span>_data_generator(self, data_loader, datafile):</div><div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Generate data using the iterator over tuples constructed by data_loader.&quot;&quot;&quot;</span></div><div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a30ca966ffb33e7cbc8f97e9b8837cbc1">is_reset</a> = <span class="keyword">False</span></div><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        <span class="keywordflow">while</span> <span class="keyword">True</span>:</div><div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;            <span class="keywordflow">for</span> episode <span class="keywordflow">in</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#abd563ce3d2e4c105b06a30ef9895c51b">_read_episode</a>(<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a35ddb652bb3255dba53d5fd69046ebb7">data_loader</a>(datafile)):</div><div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;                <span class="keywordflow">yield</span> episode</div><div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;            <span class="keywordflow">yield</span> -1</div><div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            <span class="keywordflow">while</span> <span class="keywordflow">not</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#af41dd0f335bb24f499376f0b55ebea93">cycle</a>:</div><div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;                <span class="keywordflow">yield</span> -1</div><div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div><div class="line"><a name="l00835"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a5f3e6484038cefcc177a635148f0b492">  835</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a5f3e6484038cefcc177a635148f0b492">load_length</a>(self):</div><div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;<span class="stringliteral">        Calculate the length of the dataset and caches it in a file.</span></div><div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;<span class="stringliteral">        Note that this can take some time for large datasets. Episode and entry</span></div><div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;<span class="stringliteral">        indexes cannot be specified during streaming.</span></div><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;        datafiles = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a4c7f45ba690d0533d6a8c5c0235155b2">datafile</a> <span class="keywordflow">if</span> <a class="code" href="namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf.html#ad5dfae268e23f506da084a9efb72f619">type</a>(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a4c7f45ba690d0533d6a8c5c0235155b2">datafile</a>) <span class="keywordflow">is</span> tuple <span class="keywordflow">else</span> [self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a4c7f45ba690d0533d6a8c5c0235155b2">datafile</a>]</div><div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        length_file = datafiles[0] + <span class="stringliteral">&quot;.lengths&quot;</span></div><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.isfile(length_file):</div><div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            num_eps = 0</div><div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            num_exs = 0</div><div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;            <span class="keywordflow">for</span> episode <span class="keywordflow">in</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#abd563ce3d2e4c105b06a30ef9895c51b">_read_episode</a>(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a35ddb652bb3255dba53d5fd69046ebb7">data_loader</a>(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a4c7f45ba690d0533d6a8c5c0235155b2">datafile</a>)):</div><div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                num_eps += 1</div><div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                num_exs += len(episode)</div><div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;            with open(length_file, <span class="stringliteral">&#39;w&#39;</span>) <span class="keyword">as</span> f:</div><div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;                f.write(<span class="stringliteral">&quot;{}\n{}&quot;</span>.<a class="code" href="namespaceparlai_1_1messenger_1_1core_1_1shared__utils.html#a11f2820425bccac8d8d490ab505bcb79">format</a>(num_eps, num_exs))</div><div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;            with open(length_file, <span class="stringliteral">&#39;r&#39;) as f:</span></div><div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="stringliteral">                num_eps, num_exs = f.readlines()</span></div><div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="stringliteral">        </span><span class="keywordflow">return</span> <a class="code" href="namespaceeval__ppl.html#a4d5b66ad0d8e1b8d7db27f256eda8340">int</a>(num_eps), <a class="code" href="namespaceeval__ppl.html#a4d5b66ad0d8e1b8d7db27f256eda8340">int</a>(num_exs)</div><div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div><div class="line"><a name="l00857"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#ada385b7a8f549f4d65eb910b668c77e5">  857</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#ada385b7a8f549f4d65eb910b668c77e5">num_examples</a>(self):</div><div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Return the number of examples in the data.&quot;&quot;&quot;</span></div><div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a6aa5dc9644a792b801bc7cf69a194ae6">num_exs</a>:</div><div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a8f5807d28b1b0a4d7eb09ae287b2c01b">num_eps</a>, self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a6aa5dc9644a792b801bc7cf69a194ae6">num_exs</a> = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a5f3e6484038cefcc177a635148f0b492">load_length</a>()</div><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a6aa5dc9644a792b801bc7cf69a194ae6">num_exs</a></div><div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div><div class="line"><a name="l00863"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a05f4816d029700a4bf9fd1eeafcb527c">  863</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a05f4816d029700a4bf9fd1eeafcb527c">num_episodes</a>(self):</div><div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Return the number of episodes in the data.&quot;&quot;&quot;</span></div><div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a8f5807d28b1b0a4d7eb09ae287b2c01b">num_eps</a>:</div><div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a8f5807d28b1b0a4d7eb09ae287b2c01b">num_eps</a>, self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a6aa5dc9644a792b801bc7cf69a194ae6">num_exs</a> = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a5f3e6484038cefcc177a635148f0b492">load_length</a>()</div><div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a8f5807d28b1b0a4d7eb09ae287b2c01b">num_eps</a></div><div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;</div><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    <span class="keyword">def </span>_lock(self):</div><div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;        <span class="keywordflow">if</span> hasattr(self, <span class="stringliteral">&#39;lock&#39;</span>):</div><div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;            <span class="keywordflow">return</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#adcc1f5f967652688ec8dbcfb3abbcaa6">lock</a></div><div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="namespaceparlai_1_1utils_1_1misc.html#a38a23cfa0fc3dbed42846787d1c04b57">no_lock</a>()</div><div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;</div><div class="line"><a name="l00875"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a34ba92f60661471fee4eedb5ee2b9eda">  875</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a34ba92f60661471fee4eedb5ee2b9eda">get</a>(self):</div><div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;<span class="stringliteral">        Get the next entry from the stream.</span></div><div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;<span class="stringliteral">        When episode is done returns first entry of next episode.</span></div><div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;        <span class="comment"># first look up data</span></div><div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a40ac215e58913119b1406b1d440a55f4">next_episode</a> != -1 <span class="keywordflow">or</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#af239ccfb38c42707c97eb8575fb82f10">entry_idx</a> != 0:</div><div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;            with self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#abe3521ed1cb416df863eb41d726ece67">_lock</a>():</div><div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a40ac215e58913119b1406b1d440a55f4">next_episode</a> <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                    self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a40ac215e58913119b1406b1d440a55f4">next_episode</a> = next(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a4acc939bddc7bf81f0e19ae9fa9f197a">data</a>)</div><div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#af239ccfb38c42707c97eb8575fb82f10">entry_idx</a> == 0:</div><div class="line"><a name="l00887"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#ae045cda37bbe4fd67fdca7f902de8862">  887</a></span>&#160;                    self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#ae045cda37bbe4fd67fdca7f902de8862">cur_episode</a> = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a40ac215e58913119b1406b1d440a55f4">next_episode</a></div><div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                    self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a40ac215e58913119b1406b1d440a55f4">next_episode</a> = next(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a4acc939bddc7bf81f0e19ae9fa9f197a">data</a>)</div><div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                entry = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#ae045cda37bbe4fd67fdca7f902de8862">cur_episode</a>[self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#af239ccfb38c42707c97eb8575fb82f10">entry_idx</a>]</div><div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div><div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                <span class="comment"># now pack it in a action-observation dictionary</span></div><div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                table = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a467bf261c35da2f5d2a34949281d2669">build_table</a>(entry)</div><div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                episode_done = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#af239ccfb38c42707c97eb8575fb82f10">entry_idx</a> == len(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#ae045cda37bbe4fd67fdca7f902de8862">cur_episode</a>) - 1</div><div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;                <span class="keywordflow">if</span> episode_done:</div><div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                    self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#af239ccfb38c42707c97eb8575fb82f10">entry_idx</a> = 0</div><div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;                    self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#af239ccfb38c42707c97eb8575fb82f10">entry_idx</a> += 1</div><div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                end_of_data = episode_done <span class="keywordflow">and</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a40ac215e58913119b1406b1d440a55f4">next_episode</a> <span class="keywordflow">is</span> -1</div><div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                <span class="keywordflow">if</span> end_of_data <span class="keywordflow">and</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#af41dd0f335bb24f499376f0b55ebea93">cycle</a>:</div><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                    self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a40ac215e58913119b1406b1d440a55f4">next_episode</a> = next(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a4acc939bddc7bf81f0e19ae9fa9f197a">data</a>)</div><div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;</div><div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;                <span class="comment"># last entry in this episode</span></div><div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                table[<span class="stringliteral">&#39;episode_done&#39;</span>] = episode_done</div><div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;            table = {<span class="stringliteral">&#39;episode_done&#39;</span>: <span class="keyword">True</span>}</div><div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            end_of_data = <span class="keyword">True</span></div><div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div><div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;        <span class="keywordflow">return</span> table, end_of_data</div><div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div><div class="line"><a name="l00911"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a6375bd13d685da4b3449caaafcc5ec13">  911</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a6375bd13d685da4b3449caaafcc5ec13">reset</a>(self):</div><div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Reset the datastream to its beginning.&quot;&quot;&quot;</span></div><div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#ae054596c459b22bbeacf622a5208b785">reset_data</a> <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;            <span class="comment"># auxiliary instance, reset main datastream</span></div><div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a4acc939bddc7bf81f0e19ae9fa9f197a">data</a> = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#ae054596c459b22bbeacf622a5208b785">reset_data</a>()</div><div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a40ac215e58913119b1406b1d440a55f4">next_episode</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <span class="keywordflow">elif</span> <span class="keywordflow">not</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a30ca966ffb33e7cbc8f97e9b8837cbc1">is_reset</a>:</div><div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            <span class="comment"># if main instance is not reset, reset datastream</span></div><div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#ad57a8129b3109fec84d99de56813b524">_load</a>(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a35ddb652bb3255dba53d5fd69046ebb7">data_loader</a>, self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a4c7f45ba690d0533d6a8c5c0235155b2">datafile</a>)</div><div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a30ca966ffb33e7cbc8f97e9b8837cbc1">is_reset</a> = <span class="keyword">True</span></div><div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a40ac215e58913119b1406b1d440a55f4">next_episode</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#af239ccfb38c42707c97eb8575fb82f10">entry_idx</a> = 0</div><div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a4acc939bddc7bf81f0e19ae9fa9f197a">data</a></div><div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;</div><div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;</div><div class="line"><a name="l00926"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html">  926</a></span>&#160;<span class="keyword">class </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html">FbDialogTeacher</a>(<a class="code" href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html">DialogTeacher</a>):</div><div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="stringliteral">    This module provides access to data in the Facebook Dialog format.</span></div><div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="stringliteral">    Subclasses ``DialogTeacher`` for functionality and provides an</span></div><div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="stringliteral">    implementation of ``setup_data()`` which iterates over datasets in the</span></div><div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="stringliteral">    &quot;fbdialog&quot; format. If your data is in the format below, use this class to</span></div><div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="stringliteral">    handle file parsing for you.</span></div><div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="stringliteral">    The way FB Dialog data is set up is as follows:</span></div><div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;<span class="stringliteral">    ::</span></div><div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;<span class="stringliteral">        1 Sam went to the kitchen.</span></div><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;<span class="stringliteral">        2 Pat gave Sam the milk.</span></div><div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;<span class="stringliteral">        3 Where is the milk?&lt;TAB&gt;kitchen&lt;TAB&gt;1&lt;TAB&gt;hallway|kitchen|bathroom</span></div><div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="stringliteral">        4 Sam went to the hallway.</span></div><div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="stringliteral">        5 Pat went to the bathroom.</span></div><div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="stringliteral">        6 Where is the milk?&lt;TAB&gt;hallway&lt;TAB&gt;1&lt;TAB&gt;hallway|kitchen|bathroom</span></div><div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="stringliteral">    Lines 1-6 represent a single episode, with two different examples: the</span></div><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;<span class="stringliteral">    first example is lines 1-3, and the second is lines 4-6.</span></div><div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;<span class="stringliteral">    Lines 1,2,4, and 5 represent contextual information.</span></div><div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="stringliteral">    Lines 3 and 6 contain a query, a label, a reward for getting the question</span></div><div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="stringliteral">    correct, and three label candidates.</span></div><div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="stringliteral">    Since both of these examples are part of the same episode, the information</span></div><div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="stringliteral">    provided in the first example is relevant to the query in the second</span></div><div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;<span class="stringliteral">    example and therefore the agent must remember the first example in order to</span></div><div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;<span class="stringliteral">    do well.</span></div><div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="stringliteral">    In general dialog in this format can contain any speech, not just QA pairs:</span></div><div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;<span class="stringliteral">    ::</span></div><div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;<span class="stringliteral">        1 Hi how&#39;s it going?&lt;TAB&gt;It&#39;s going great. What&#39;s new?</span></div><div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="stringliteral">        2 Well I&#39;m working on a new project at work.&lt;TAB&gt;Oh me too!</span></div><div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;<span class="stringliteral">        3 Oh cool!&lt;TAB&gt;Tell me about yours.</span></div><div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="stringliteral">    etc.</span></div><div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="stringliteral">    Note that dialogs are interpreted as being one-way. For example, consider</span></div><div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="stringliteral">    this dialog:</span></div><div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;<span class="stringliteral">    ::</span></div><div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;<span class="stringliteral">        1 X1    Y1</span></div><div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;<span class="stringliteral">        2 X2    Y2</span></div><div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;<span class="stringliteral">        3 X3    Y3</span></div><div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="stringliteral">    A set of examples X1 =&gt; Y1, X2 =&gt; Y2, and X3 =&gt; Y3 will be generated.</span></div><div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="stringliteral">    However, Y1 =&gt; X2 and Y2 =&gt; X3 are not created as separate examples by</span></div><div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="stringliteral">    default. This makes sense for some data (we don&#39;t need to train on the idea</span></div><div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="stringliteral">    that &quot;kitchen&quot; should be followed by &quot;Sam went to the hallway...&quot; above),</span></div><div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="stringliteral">    but for other datasets it may be helpful to add additional examples in the</span></div><div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="stringliteral">    reverse direction (&quot;Oh cool!&quot; is a response to &quot;Oh me too!&quot; above).</span></div><div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;</div><div class="line"><a name="l00986"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a52316baa31ca0881d4cd98ec2fbebad5">  986</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a52316baa31ca0881d4cd98ec2fbebad5">__init__</a>(self, opt, shared=None):</div><div class="line"><a name="l00987"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#af7a9ec497b9cd0292d7b8fa220da7c28">  987</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Agent.html#ab3b45d2754244608c75d4068b90cd051">opt</a> = opt</div><div class="line"><a name="l00988"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a8505bfe962961b04961280a6e4c603f4">  988</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a8505bfe962961b04961280a6e4c603f4">cloze</a> = opt.get(<span class="stringliteral">&#39;cloze&#39;</span>, <span class="keyword">False</span>)</div><div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        <span class="keywordflow">if</span> shared <span class="keywordflow">and</span> <span class="stringliteral">&#39;cands&#39;</span> <span class="keywordflow">in</span> shared:</div><div class="line"><a name="l00990"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a3ec67545250d8a877038667e3f4ea158">  990</a></span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a3ec67545250d8a877038667e3f4ea158">cands</a> = shared[<span class="stringliteral">&#39;cands&#39;</span>]</div><div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a3ec67545250d8a877038667e3f4ea158">cands</a> = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#ae6f10486ddf691ee868d33ea2c9dc295">load_cands</a>(opt.get(<span class="stringliteral">&#39;cands_datafile&#39;</span>, <span class="keywordtype">None</span>))</div><div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;        super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a52316baa31ca0881d4cd98ec2fbebad5">__init__</a>(opt, shared)</div><div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;</div><div class="line"><a name="l00995"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a18a4ea7a7f21eeed7e087cb447a37c5a">  995</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a18a4ea7a7f21eeed7e087cb447a37c5a">share</a>(self):</div><div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Share the data and canidates.&quot;&quot;&quot;</span></div><div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;        shared = super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a18a4ea7a7f21eeed7e087cb447a37c5a">share</a>()</div><div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;        shared[<span class="stringliteral">&#39;cands&#39;</span>] = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a3ec67545250d8a877038667e3f4ea158">cands</a></div><div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;        <span class="keywordflow">return</span> shared</div><div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;</div><div class="line"><a name="l01001"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#ab3ff2f1a0707aae7bf888fb13ec49641"> 1001</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#ab3ff2f1a0707aae7bf888fb13ec49641">label_candidates</a>(self):</div><div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Return the candidates.&quot;&quot;&quot;</span></div><div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a3ec67545250d8a877038667e3f4ea158">cands</a></div><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div><div class="line"><a name="l01005"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#ae6f10486ddf691ee868d33ea2c9dc295"> 1005</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#ae6f10486ddf691ee868d33ea2c9dc295">load_cands</a>(self, path):</div><div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;<span class="stringliteral">        Load a global fixed set of candidates.</span></div><div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;<span class="stringliteral">        The candidates will be provided by the teacher for</span></div><div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="stringliteral">        every example (the true labels for a specific example are also added to</span></div><div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="stringliteral">        this set, so that it&#39;s possible to get the right answer).</span></div><div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <span class="keywordflow">if</span> path <span class="keywordflow">is</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;            <span class="keywordflow">return</span> <span class="keywordtype">None</span></div><div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;        cands = []</div><div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        lines_have_ids = <span class="keyword">False</span></div><div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;        cands_are_replies = <span class="keyword">False</span></div><div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;        cnt = 0</div><div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;        with open(path) <span class="keyword">as</span> read:</div><div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;            <span class="keywordflow">for</span> line <span class="keywordflow">in</span> read:</div><div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                line = line.strip().replace(<span class="stringliteral">&#39;\\n&#39;</span>, <span class="stringliteral">&#39;\n&#39;</span>)</div><div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;                <span class="keywordflow">if</span> len(line) &gt; 0:</div><div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                    cnt = cnt + 1</div><div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                    <span class="comment"># If lines are numbered we strip them of numbers.</span></div><div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                    <span class="keywordflow">if</span> cnt == 1 <span class="keywordflow">and</span> line[0:2] == <span class="stringliteral">&#39;1 &#39;</span>:</div><div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                        lines_have_ids = <span class="keyword">True</span></div><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                    <span class="comment"># If tabs then the label_candidates are all the replies.</span></div><div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;                    <span class="keywordflow">if</span> <span class="stringliteral">&#39;\t&#39;</span> <span class="keywordflow">in</span> line <span class="keywordflow">and</span> <span class="keywordflow">not</span> cands_are_replies:</div><div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                        cands_are_replies = <span class="keyword">True</span></div><div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                        cands = []</div><div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                    <span class="keywordflow">if</span> lines_have_ids:</div><div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;                        space_idx = line.find(<span class="stringliteral">&#39; &#39;</span>)</div><div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                        line = line[space_idx + 1 :]</div><div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                        <span class="keywordflow">if</span> cands_are_replies:</div><div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                            sp = line.split(<span class="stringliteral">&#39;\t&#39;</span>)</div><div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                            <span class="keywordflow">if</span> len(sp) &gt; 1 <span class="keywordflow">and</span> sp[1] != <span class="stringliteral">&#39;&#39;</span>:</div><div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;                                cands.append(sp[1])</div><div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                            cands.append(line)</div><div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                        cands.append(line)</div><div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;        <span class="keywordflow">return</span> cands</div><div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;</div><div class="line"><a name="l01044"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a6cb23867e396fac5fdcde509b5da3942"> 1044</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a6cb23867e396fac5fdcde509b5da3942">setup_data</a>(self, path):</div><div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;        <span class="stringliteral">r&quot;&quot;&quot;</span></div><div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;<span class="stringliteral">        Read data in the fbdialog format.</span></div><div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="stringliteral">        Returns ``((x,y,r,c), new_episode?)`` tuples.</span></div><div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;<span class="stringliteral">        ``x`` represents a query, ``y`` represents the labels, ``r`` represents</span></div><div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;<span class="stringliteral">        any reward, and ``c`` represents any label_candidates.</span></div><div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;<span class="stringliteral">        The example above will be translated into the following tuples:</span></div><div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;<span class="stringliteral">        ::</span></div><div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;<span class="stringliteral">            x: &#39;Sam went to the kitchen\nPat gave Sam the milk\nWhere is the milk?&#39;</span></div><div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;<span class="stringliteral">            y: [&#39;kitchen&#39;]</span></div><div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;<span class="stringliteral">            r: &#39;1&#39;</span></div><div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;<span class="stringliteral">            c: [&#39;hallway&#39;, &#39;kitchen&#39;, &#39;bathroom&#39;]</span></div><div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;<span class="stringliteral">            new_episode = True (this is the first example in the episode)</span></div><div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;<span class="stringliteral">        ::</span></div><div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="stringliteral">            x: &#39;Sam went to the hallway\\nPat went to the bathroom\\nWhere is the</span></div><div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;<span class="stringliteral">                milk?&#39;</span></div><div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;<span class="stringliteral">            y: [&#39;hallway&#39;]</span></div><div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;<span class="stringliteral">            r: &#39;1&#39;</span></div><div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;<span class="stringliteral">            c: [&#39;hallway&#39;, &#39;kitchen&#39;, &#39;bathroom&#39;]</span></div><div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="stringliteral">            new_episode = False (this is the second example in the episode)</span></div><div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;        print(<span class="stringliteral">&quot;[loading fbdialog data:&quot;</span> + path + <span class="stringliteral">&quot;]&quot;</span>)</div><div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        with open(path) <span class="keyword">as</span> read:</div><div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;            start = <span class="keyword">True</span></div><div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;            x = <span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;            reward = 0</div><div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;            last_conv_id = <span class="keywordtype">None</span></div><div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            <span class="keywordflow">for</span> line <span class="keywordflow">in</span> read:</div><div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;                line = line.strip().replace(<span class="stringliteral">&#39;\\n&#39;</span>, <span class="stringliteral">&#39;\n&#39;</span>)</div><div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                <span class="keywordflow">if</span> len(line) == 0:</div><div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;                    <span class="comment"># empty response</span></div><div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;                    <span class="keywordflow">continue</span></div><div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;</div><div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                <span class="comment"># first, get conversation index -- &#39;1&#39; means start of episode</span></div><div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                space_idx = line.find(<span class="stringliteral">&#39; &#39;</span>)</div><div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                <span class="keywordflow">if</span> space_idx == -1:</div><div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                    <span class="comment"># empty line, both individuals are saying whitespace</span></div><div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                    conv_id = <a class="code" href="namespaceeval__ppl.html#a4d5b66ad0d8e1b8d7db27f256eda8340">int</a>(line)</div><div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                    conv_id = <a class="code" href="namespaceeval__ppl.html#a4d5b66ad0d8e1b8d7db27f256eda8340">int</a>(line[:space_idx])</div><div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;</div><div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                <span class="comment"># split line into constituent parts, if available:</span></div><div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                <span class="comment"># x&lt;tab&gt;y&lt;tab&gt;reward&lt;tab&gt;label_candidates</span></div><div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                <span class="comment"># where y, reward, and label_candidates are optional</span></div><div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                split = line[space_idx + 1 :].split(<span class="stringliteral">&#39;\t&#39;</span>)</div><div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;</div><div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                <span class="comment"># remove empty items and strip each one</span></div><div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                <span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(len(split)):</div><div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                    word = split[i].strip()</div><div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                    <span class="keywordflow">if</span> len(word) == 0:</div><div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                        split[i] = <span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                        split[i] = word</div><div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;                <span class="comment"># Empty reward string same as None</span></div><div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;                <span class="keywordflow">if</span> len(split) &gt; 2 <span class="keywordflow">and</span> split[2] == <span class="stringliteral">&#39;&#39;</span>:</div><div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;                    split[2] = <span class="keywordtype">None</span></div><div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;</div><div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;                <span class="comment"># now check if we&#39;re at a new episode</span></div><div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;                <span class="keywordflow">if</span> last_conv_id <span class="keywordflow">is</span> <span class="keywordtype">None</span> <span class="keywordflow">or</span> conv_id &lt;= last_conv_id:</div><div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;                    x = x.strip()</div><div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                    <span class="keywordflow">if</span> x:</div><div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                        <span class="keywordflow">yield</span> [x, <span class="keywordtype">None</span>, reward], start</div><div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                    start = <span class="keyword">True</span></div><div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;                    reward = 0</div><div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                    <span class="comment"># start a new episode</span></div><div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                    <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a8505bfe962961b04961280a6e4c603f4">cloze</a>:</div><div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;                        x = <span class="stringliteral">&#39;Fill in the blank in the last sentence.\n{x}&#39;</span>.<a class="code" href="namespaceparlai_1_1messenger_1_1core_1_1shared__utils.html#a11f2820425bccac8d8d490ab505bcb79">format</a>(</div><div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;                            x=split[0]</div><div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;                        )</div><div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;                        x = split[0]</div><div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                    <span class="keywordflow">if</span> x:</div><div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                        <span class="comment"># otherwise add current x to what we have so far</span></div><div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                        x = <span class="stringliteral">&#39;{x}\n{next_x}&#39;</span>.<a class="code" href="namespaceparlai_1_1messenger_1_1core_1_1shared__utils.html#a11f2820425bccac8d8d490ab505bcb79">format</a>(x=x, next_x=split[0])</div><div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                        x = split[0]</div><div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                last_conv_id = conv_id</div><div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                <span class="keywordflow">if</span> len(split) &gt; 2 <span class="keywordflow">and</span> split[2]:</div><div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                    reward += <a class="code" href="namespacemake__control__dataset.html#aab4734ca3fc74fda1c53ad21ec9f47b0">float</a>(split[2])</div><div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;</div><div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                <span class="keywordflow">if</span> len(split) &gt; 1 <span class="keywordflow">and</span> split[1]:</div><div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                    <span class="comment"># only generate an example if we have a y</span></div><div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                    split[0] = x</div><div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                    <span class="comment"># split labels</span></div><div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                    split[1] = split[1].split(<span class="stringliteral">&#39;|&#39;</span>)</div><div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                    <span class="keywordflow">if</span> len(split) &gt; 3:</div><div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;                        <span class="comment"># split label_candidates</span></div><div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                        split[3] = split[3].split(<span class="stringliteral">&#39;|&#39;</span>)</div><div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                    <span class="keywordflow">if</span> len(split) &gt; 2:</div><div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                        split[2] = reward</div><div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                        split.append(reward)</div><div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;                    <span class="keywordflow">if</span> start:</div><div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;                        <span class="keywordflow">yield</span> split, <span class="keyword">True</span></div><div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;                        start = <span class="keyword">False</span></div><div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                    <span class="keywordflow">else</span>:</div><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;                        <span class="keywordflow">yield</span> split, <span class="keyword">False</span></div><div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                    <span class="comment"># reset x in case there is unlabeled data still left</span></div><div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;                    x = <span class="stringliteral">&#39;&#39;</span></div><div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                    reward = 0</div><div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;            <span class="keywordflow">if</span> x:</div><div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                <span class="keywordflow">yield</span> [x, <span class="keywordtype">None</span>, reward], start</div><div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;</div><div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;</div><div class="line"><a name="l01157"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html"> 1157</a></span>&#160;<span class="keyword">class </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html">ParlAIDialogTeacher</a>(<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html">FixedDialogTeacher</a>):</div><div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;<span class="stringliteral">    This module provides access to data in the ParlAI Text Dialog format.</span></div><div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;<span class="stringliteral">    Subclasses ``FixedDialogTeacher`` for functionality and provides an</span></div><div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="stringliteral">    implementation of ``setup_data()`` which iterates over datasets in the</span></div><div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="stringliteral">    &quot;ParlAI text&quot; format. If your data is in the format below, use this class to</span></div><div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="stringliteral">    handle file parsing for you.</span></div><div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;<span class="stringliteral">    The way the data is set up is as follows:</span></div><div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;<span class="stringliteral">    ::</span></div><div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;<span class="stringliteral">        text:Sam went to the kitchen. &lt;NEWL&gt;</span></div><div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;<span class="stringliteral">        Pat gave Sam the milk. &lt;NEWL&gt;</span></div><div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;<span class="stringliteral">        Where is the milk? &lt;TAB&gt; labels:kitchen &lt;TAB&gt; reward:1</span></div><div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;<span class="stringliteral">        &lt;TAB&gt; label_candidates:hallway|kitchen|bathroom</span></div><div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;<span class="stringliteral">        text:Sam went to the hallway. &lt;NEWL&gt;</span></div><div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;<span class="stringliteral">        Pat went to the bathroom. &lt;NEWL&gt;</span></div><div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;<span class="stringliteral">        Where is the milk? &lt;TAB&gt; labels:hallway &lt;TAB&gt; reward:1</span></div><div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;<span class="stringliteral">        &lt;TAB&gt; label_candidates:hallway|kitchen|bathroom &lt;TAB&gt; episode_done:True</span></div><div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;<span class="stringliteral">    Lines 1-2 represent a single episode, with a different example on each line.</span></div><div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;<span class="stringliteral">    The lines contain a query and a label for getting the question</span></div><div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;<span class="stringliteral">    correct, and three label candidates.</span></div><div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;<span class="stringliteral">    Since both of these examples are part of the same episode, the information</span></div><div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;<span class="stringliteral">    provided in the first example is relevant to the query in the second</span></div><div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;<span class="stringliteral">    example and therefore the agent must remember the first example in order to</span></div><div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;<span class="stringliteral">    do well.</span></div><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;<span class="stringliteral">    In general dialog this format can contain any speech, not just QA pairs:</span></div><div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="stringliteral">    ::</span></div><div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="stringliteral">        text:Hi how&#39;s it going?&lt;TAB&gt;labels:It&#39;s going great. What&#39;s new?</span></div><div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;<span class="stringliteral">        text:Well I&#39;m working on a new project at work.&lt;TAB&gt;labels:Oh me too!</span></div><div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;<span class="stringliteral">        text:Oh cool!&lt;TAB&gt;labels:Tell me about yours.</span></div><div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;<span class="stringliteral">    etc.</span></div><div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="stringliteral">    Note that dialogs are interpreted as being one-way. For example, consider</span></div><div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;<span class="stringliteral">    this dialog:</span></div><div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;<span class="stringliteral">    ::</span></div><div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;<span class="stringliteral">        1 X1    Y1</span></div><div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;<span class="stringliteral">        2 X2    Y2</span></div><div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="stringliteral">        3 X3    Y3</span></div><div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="stringliteral">    A set of examples X1 =&gt; Y1, X2 =&gt; Y2, and X3 =&gt; Y3 will be generated.</span></div><div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="stringliteral">    However, Y1 =&gt; X2 and Y2 =&gt; X3 are not created as separate examples by</span></div><div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;<span class="stringliteral">    default. This makes sense for some data (we don&#39;t need to train on the idea</span></div><div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;<span class="stringliteral">    that &quot;kitchen&quot; should be followed by &quot;Sam went to the hallway...&quot; above),</span></div><div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;<span class="stringliteral">    but for other datasets it may be helpful to add additional examples in the</span></div><div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;<span class="stringliteral">    reverse direction (&quot;Oh cool!&quot; is a response to &quot;Oh me too!&quot; above).</span></div><div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;</div><div class="line"><a name="l01215"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#ad79a47d28e60c24df72b8523aff6b247"> 1215</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#ad79a47d28e60c24df72b8523aff6b247">__init__</a>(self, opt, shared=None):</div><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;        super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#ad79a47d28e60c24df72b8523aff6b247">__init__</a>(opt, shared)</div><div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> shared:</div><div class="line"><a name="l01218"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a99d92211286cdcc382f723ebc9d272c4"> 1218</a></span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a99d92211286cdcc382f723ebc9d272c4">episodes</a> = []</div><div class="line"><a name="l01219"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#accef414b3b1e708e7dd71a3e1871261f"> 1219</a></span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#accef414b3b1e708e7dd71a3e1871261f">num_exs</a> = 0</div><div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;            <span class="keywordflow">if</span> opt.get(<span class="stringliteral">&#39;parlaidialogteacher_datafile&#39;</span>) <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a92fb71aa4e5d3a4751d78ecca202c608">_setup_data</a>(opt.get(<span class="stringliteral">&#39;parlaidialogteacher_datafile&#39;</span>))</div><div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a99d92211286cdcc382f723ebc9d272c4">episodes</a> = shared[<span class="stringliteral">&#39;episodes&#39;</span>]</div><div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#accef414b3b1e708e7dd71a3e1871261f">num_exs</a> = sum(len(e) <span class="keywordflow">for</span> e <span class="keywordflow">in</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a99d92211286cdcc382f723ebc9d272c4">episodes</a>)</div><div class="line"><a name="l01225"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a07870e07e8e6f708974ac9f51600e4fa"> 1225</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Agent.html#ac00c13f4c7dd1263bf9203fa96dd2366">id</a> = opt.get(<span class="stringliteral">&#39;parlaidialogteacher_datafile&#39;</span>, <span class="stringliteral">&#39;teacher&#39;</span>)</div><div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Agent.html#a27cb8206372681605b00dc28b81a7c39">reset</a>()</div><div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;</div><div class="line"><a name="l01228"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a9e2eabf923a38b53865705786e07f461"> 1228</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a9e2eabf923a38b53865705786e07f461">share</a>(self):</div><div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Share the episodes.&quot;&quot;&quot;</span></div><div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        shared = super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a9e2eabf923a38b53865705786e07f461">share</a>()</div><div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        shared[<span class="stringliteral">&#39;episodes&#39;</span>] = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a99d92211286cdcc382f723ebc9d272c4">episodes</a></div><div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        <span class="keywordflow">return</span> shared</div><div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;</div><div class="line"><a name="l01234"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a37c1c62c52860da9c63d9f6ed23ae6ae"> 1234</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a37c1c62c52860da9c63d9f6ed23ae6ae">num_examples</a>(self):</div><div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Return the number of examples from the data.&quot;&quot;&quot;</span></div><div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#accef414b3b1e708e7dd71a3e1871261f">num_exs</a></div><div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;</div><div class="line"><a name="l01238"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#aee1494d5dd0610530b4b93e56010e6f8"> 1238</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#aee1494d5dd0610530b4b93e56010e6f8">num_episodes</a>(self):</div><div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Return the number of episodes from the data.&quot;&quot;&quot;</span></div><div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        <span class="keywordflow">return</span> len(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a99d92211286cdcc382f723ebc9d272c4">episodes</a>)</div><div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;</div><div class="line"><a name="l01242"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a0ef5a3bbad31d95bc398a393ab0a310d"> 1242</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a0ef5a3bbad31d95bc398a393ab0a310d">get</a>(self, episode_idx, entry_idx=None):</div><div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Get a specific example from the dataset.&quot;&quot;&quot;</span></div><div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a99d92211286cdcc382f723ebc9d272c4">episodes</a>[episode_idx][entry_idx]</div><div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;</div><div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;    <span class="keyword">def </span>_setup_data(self, path):</div><div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;        print(<span class="stringliteral">&quot;[loading parlAI text data:&quot;</span> + path + <span class="stringliteral">&quot;]&quot;</span>)</div><div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a99d92211286cdcc382f723ebc9d272c4">episodes</a> = []</div><div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#accef414b3b1e708e7dd71a3e1871261f">num_exs</a> = 0</div><div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;        eps = []</div><div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;        with open(path, newline=<span class="stringliteral">&#39;\n&#39;</span>) <span class="keyword">as</span> read:</div><div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;            <span class="keywordflow">for</span> line <span class="keywordflow">in</span> read:</div><div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                msg = <a class="code" href="namespaceparlai_1_1utils_1_1misc.html#a1b053cd9c56e6fa79b058fff587b3a48">str_to_msg</a>(line.rstrip(<span class="stringliteral">&#39;\n&#39;</span>))</div><div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;                <span class="keywordflow">if</span> msg:</div><div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;                    self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#accef414b3b1e708e7dd71a3e1871261f">num_exs</a> += 1</div><div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;                    eps.append(msg)</div><div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;                    <span class="keywordflow">if</span> msg.get(<span class="stringliteral">&#39;episode_done&#39;</span>, <span class="keyword">False</span>):</div><div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;                        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a99d92211286cdcc382f723ebc9d272c4">episodes</a>.append(eps)</div><div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                        eps = []</div><div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;        <span class="keywordflow">if</span> len(eps) &gt; 0:</div><div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;            <span class="comment"># add last episode</span></div><div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;            eps[-1].force_set(<span class="stringliteral">&#39;episode_done&#39;</span>, <span class="keyword">True</span>)</div><div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a99d92211286cdcc382f723ebc9d272c4">episodes</a>.append(eps)</div><div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;</div><div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;</div><div class="line"><a name="l01266"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html"> 1266</a></span>&#160;<span class="keyword">class </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html">AbstractImageTeacher</a>(<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html">FixedDialogTeacher</a>):</div><div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;<span class="stringliteral">    Abstract class to allow easier creation of image + dialogue tasks.</span></div><div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;<span class="stringliteral">    This class handles creating image features via ImageLoader if applicable</span></div><div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;<span class="stringliteral">    (resnet, resnext variants) or loading existing image features from a dict</span></div><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;<span class="stringliteral">    path as per get_image_features_path().</span></div><div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;<span class="stringliteral">    Important methods and properties (override in subclass if needed):</span></div><div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="stringliteral">    - get_data_path(): where data file is found (default: &lt;datapath&gt;/&lt;task&gt;)</span></div><div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;<span class="stringliteral">    - get_image_path(): where images found (default: &lt;datapath&gt;/&lt;task&gt;/images)</span></div><div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="stringliteral">    - get_image_features_path(): dict of image features (default:</span></div><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="stringliteral">      &lt;datapath&gt;/&lt;task&gt;/image_features)</span></div><div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;<span class="stringliteral">    - @property image_id_key: which key in data file objects represents image_id</span></div><div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="stringliteral">    - @property text_key: which key in data file objects represents text</span></div><div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="stringliteral">    Note: Assumes data files are named &lt;dt&gt;.json</span></div><div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="stringliteral">    @abstractmethod image_id_to_image_path() must be implemented in</span></div><div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;<span class="stringliteral">    subclass</span></div><div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;<span class="stringliteral">    Example with the key defaults (but the keys can be customized):</span></div><div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;<span class="stringliteral">    obs = {&#39;text&#39;: &lt;caption&gt;,</span></div><div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;<span class="stringliteral">        &#39;image&#39;: &lt;image features if specified else image&gt;</span></div><div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;<span class="stringliteral">        }</span></div><div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;<span class="stringliteral">    &quot;&quot;&quot;</span></div><div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;</div><div class="line"><a name="l01292"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aab36cededc1817fee5109293bd62c51d"> 1292</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aab36cededc1817fee5109293bd62c51d">__init__</a>(self, opt, shared=None):</div><div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;        super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aab36cededc1817fee5109293bd62c51d">__init__</a>(opt, shared)</div><div class="line"><a name="l01294"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aa7ca0df94cb27a11487e40343cc84de6"> 1294</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Agent.html#ab3b45d2754244608c75d4068b90cd051">opt</a> = opt</div><div class="line"><a name="l01295"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a78dca77e43183d22d75140ca113d821c"> 1295</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a78dca77e43183d22d75140ca113d821c">task</a> = opt[<span class="stringliteral">&#39;task&#39;</span>].split(<span class="stringliteral">&#39;:&#39;</span>)[1] <span class="keywordflow">if</span> <span class="stringliteral">&#39;:&#39;</span> <span class="keywordflow">in</span> opt[<span class="stringliteral">&#39;task&#39;</span>] <span class="keywordflow">else</span> opt[<span class="stringliteral">&#39;task&#39;</span>]</div><div class="line"><a name="l01296"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a9fb2d3ab4b52f70872460c624bad1218"> 1296</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a9fb2d3ab4b52f70872460c624bad1218">data_path</a> = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aa3c1da773025838ffa03b47c3fc21c7e">get_data_path</a>(opt)</div><div class="line"><a name="l01297"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a4015f3b73718e13896bb464378a269f1"> 1297</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a4015f3b73718e13896bb464378a269f1">data</a> = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ad110a80a077e9e1135d4241083786199">load_data</a>(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a9fb2d3ab4b52f70872460c624bad1218">data_path</a>, self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Agent.html#ab3b45d2754244608c75d4068b90cd051">opt</a>)</div><div class="line"><a name="l01298"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a335cba069093a1e1cff8f73fad9f11d1"> 1298</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a65c9039b783299ad6033ccbb995ca493">datatype</a> = opt.get(<span class="stringliteral">&#39;datatype&#39;</span>).split(<span class="stringliteral">&#39;:&#39;</span>)[0]</div><div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;</div><div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        <span class="comment"># Example of available models: &#39;resnet152&#39;, &#39;resnext101_32x48d_wsl&#39;,</span></div><div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;        <span class="comment"># and ImageLoader supports other resnet and resnext models too</span></div><div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        <span class="comment"># Raises an Exception if not valid</span></div><div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ad715c327a4cc7ad3b40a1314157dbc6d">_validate_image_mode_name</a>(opt.get(<span class="stringliteral">&#39;image_mode&#39;</span>))</div><div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;</div><div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        <span class="comment"># IMPORTANT NOTE: this teacher will be instantiated twice. The first</span></div><div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;        <span class="comment"># by build_dict in which case the image_mode is to &#39;none&#39; to avoid</span></div><div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;        <span class="comment"># calculating image features twice. We should change &#39;none&#39; to</span></div><div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;        <span class="comment"># &#39;no_image_model&#39;</span></div><div class="line"><a name="l01309"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a72abb2921076e7597cc946275983028b"> 1309</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a72abb2921076e7597cc946275983028b">image_mode</a> = opt.get(<span class="stringliteral">&#39;image_mode&#39;</span>)</div><div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;</div><div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;        <span class="comment"># Not using default image_mode paramater b/c there is a normalization</span></div><div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        <span class="comment"># (or bug) somewhere in build_dict that is setting it to none</span></div><div class="line"><a name="l01313"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a0e4ee3692e19e0f1df2fef8f21d058ab"> 1313</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a0e4ee3692e19e0f1df2fef8f21d058ab">include_image</a> = opt.get(<span class="stringliteral">&#39;image_mode&#39;</span>) != <span class="stringliteral">&#39;none&#39;</span></div><div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;</div><div class="line"><a name="l01315"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aff2a7f405e051f014ece5cc124aa170c"> 1315</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aff2a7f405e051f014ece5cc124aa170c">image_path</a> = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a22a280003b7f4202e0d917040bd56eb8">get_image_path</a>(opt)</div><div class="line"><a name="l01316"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aaf426bd12c83e8f8d5a217481cbf854b"> 1316</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aaf426bd12c83e8f8d5a217481cbf854b">image_loader</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l01317"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a67fc5068ab7e2c1c718614cc737d6a75"> 1317</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a67fc5068ab7e2c1c718614cc737d6a75">image_features_dict</a> = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a29fce019ea9795947235ba208aa4bfb0">get_image_features_path</a>(</div><div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a78dca77e43183d22d75140ca113d821c">task</a>, self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a72abb2921076e7597cc946275983028b">image_mode</a>, self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a65c9039b783299ad6033ccbb995ca493">datatype</a></div><div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        )</div><div class="line"><a name="l01320"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a708601003f79d10c98a1933501ce658f"> 1320</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a708601003f79d10c98a1933501ce658f">image_features_dim</a> = opt.get(<span class="stringliteral">&#39;image_features_dim&#39;</span>)</div><div class="line"><a name="l01321"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a0c48c489fee91d94cf8d62b902bd6b27"> 1321</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a0c48c489fee91d94cf8d62b902bd6b27">blank_image_features</a> = torch.FloatTensor(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a708601003f79d10c98a1933501ce658f">image_features_dim</a>).fill_(0)</div><div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;</div><div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        <span class="keywordflow">if</span> shared <span class="keywordflow">and</span> <span class="stringliteral">&#39;data&#39;</span> <span class="keywordflow">in</span> shared:</div><div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a4015f3b73718e13896bb464378a269f1">data</a> = shared[<span class="stringliteral">&#39;data&#39;</span>]</div><div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aaf426bd12c83e8f8d5a217481cbf854b">image_loader</a> = shared[<span class="stringliteral">&#39;image_loader&#39;</span>]</div><div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;            <span class="keywordflow">if</span> <span class="stringliteral">&#39;image_features_dict&#39;</span> <span class="keywordflow">in</span> shared:</div><div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a67fc5068ab7e2c1c718614cc737d6a75">image_features_dict</a> = shared[<span class="stringliteral">&#39;image_features_dict&#39;</span>]</div><div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;        <span class="keywordflow">elif</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a0e4ee3692e19e0f1df2fef8f21d058ab">include_image</a>:</div><div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aa6ac386d509d428870124c27265363bb">setup_image_features</a>(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a9fb2d3ab4b52f70872460c624bad1218">data_path</a>)</div><div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;            <span class="comment"># This will happen when building the dictionary - is normal</span></div><div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;            <span class="comment"># build_dict sets image_mode to &#39;none&#39;</span></div><div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;            <a class="code" href="namespaceparlai_1_1utils_1_1misc.html#acf146e70ea7f6867969a7c2b545d4b4b">warn_once</a>(<span class="stringliteral">&#39;AbstractImageTeacher self.include_image was False&#39;</span>)</div><div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;</div><div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;        <span class="comment"># TODO: won&#39;t need this after we have proper logging levels set</span></div><div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a30c5880e14b65476ed8d9e6d63e04b2f">__verbose</a> = <span class="keyword">False</span></div><div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;</div><div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Agent.html#a27cb8206372681605b00dc28b81a7c39">reset</a>()</div><div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;</div><div class="line"><a name="l01340"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ab64513ca6c2b1c358f180ee0846b26e0"> 1340</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ab64513ca6c2b1c358f180ee0846b26e0">get_available_image_mode_names</a>(self):</div><div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="stringliteral">        Available image model names.</span></div><div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="stringliteral">        resnet and resnext variants available from the ImageLoader.</span></div><div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="stringliteral">        resnext101_XXXXX_wsl is the open-sourced FB AI model (960m images, 1.5k</span></div><div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="stringliteral">        hashtags, finetuned on ImageNet).</span></div><div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;        available_model_names = ImageLoader.get_available_model_names()</div><div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;        <span class="keywordflow">return</span> [<span class="stringliteral">&#39;none&#39;</span>] + available_model_names</div><div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;</div><div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <span class="keyword">def </span>_validate_image_mode_name(self, a):</div><div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="stringliteral">        Validate the image_mode passed in.</span></div><div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="stringliteral">        Needed because image_mode used elsewhere in ParlAI is not always</span></div><div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="stringliteral">        consistent with what the image teacher allows.</span></div><div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> isinstance(a, str):</div><div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;            <span class="keywordflow">raise</span> argparse.ArgumentTypeError(</div><div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;                <span class="stringliteral">&#39;%s must be a string representing image model name&#39;</span> % a</div><div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;            )</div><div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;        available_model_names = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ab64513ca6c2b1c358f180ee0846b26e0">get_available_image_mode_names</a>()</div><div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;        <span class="keywordflow">if</span> a <span class="keywordflow">not</span> <span class="keywordflow">in</span> available_model_names:</div><div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;            <span class="keywordflow">raise</span> argparse.ArgumentTypeError(</div><div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;                <span class="stringliteral">&#39;\&quot;%s\&quot; unknown image model name. Choose from: %s. Currently suggested resnet is resnet152 and resnext is resnext101_32x48d_wsl.&#39;</span></div><div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;                % (a, available_model_names)</div><div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;            )</div><div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;        <span class="keywordflow">return</span> a</div><div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;</div><div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    @classmethod</div><div class="line"><a name="l01372"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a2735899e5787c14da39443179db6c84b"> 1372</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a2735899e5787c14da39443179db6c84b">add_cmdline_args</a>(cls, argparser):</div><div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        <span class="comment"># Be sure to call super() if overriding this method b/c</span></div><div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;        <span class="comment"># AbstractImageTeacher has necessary params</span></div><div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;        agent = argparser.add_argument_group(<span class="stringliteral">&#39;AbstractImageTeacher Arguments&#39;</span>)</div><div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;        agent.add_argument(</div><div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;            <span class="stringliteral">&#39;--image-path&#39;</span>,</div><div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;            type=str,</div><div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;            default=<span class="keywordtype">None</span>,</div><div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;            help=<span class="stringliteral">&#39;Optional argument to specify where images for dataset are&#39;</span></div><div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;            <span class="stringliteral">&#39;stored if already downloaded. Most tasks will download the images&#39;</span></div><div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;            <span class="stringliteral">&#39;if not present on the &lt; datapath &gt; / &lt; task &gt; _images / * and * if&#39;</span></div><div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;            <span class="stringliteral">&#39;this argument is not specified.&#39;</span>,</div><div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;        )</div><div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;</div><div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;        agent.add_argument(</div><div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;            <span class="stringliteral">&#39;--image-features-dim&#39;</span>,</div><div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;            type=int,</div><div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;            default=2048,</div><div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;            help=<span class="stringliteral">&#39;Specify the size of image features Tensors.&#39;</span>,</div><div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        )</div><div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;</div><div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;    @property</div><div class="line"><a name="l01394"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ada83f1832b7c75f9daab8e4d196ba893"> 1394</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ada83f1832b7c75f9daab8e4d196ba893">image_id_key</a>(self):</div><div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="stringliteral">        Which key in the input data dict objects uniquely identify each image.</span></div><div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;<span class="stringliteral">        Common image keys are &quot;image_id&quot; or &quot;image_num&quot;. May be implemented by</span></div><div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;<span class="stringliteral">        subclass.</span></div><div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;image_id&#39;</span></div><div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;</div><div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    @property</div><div class="line"><a name="l01404"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a95e578f9650f77c1d397319b9050af51"> 1404</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a95e578f9650f77c1d397319b9050af51">text_key</a>(self):</div><div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;<span class="stringliteral">        Which key in the input data dict objects identifies the text.</span></div><div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;<span class="stringliteral">        Common keys are &quot;text&quot; or &quot;comment&quot;. May be implemented by subclass.</span></div><div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;        <span class="keywordflow">return</span> <span class="stringliteral">&#39;text&#39;</span></div><div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;</div><div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;    @abstractmethod</div><div class="line"><a name="l01413"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aa75286450850638274d7f076a81f7e90"> 1413</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aa75286450850638274d7f076a81f7e90">image_id_to_image_path</a>(self, image_id):</div><div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;<span class="stringliteral">        Get the path of the image on disk.</span></div><div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;<span class="stringliteral">        Must be implemented by subclass.</span></div><div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;        <span class="keywordflow">pass</span></div><div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;</div><div class="line"><a name="l01421"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aa3c1da773025838ffa03b47c3fc21c7e"> 1421</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aa3c1da773025838ffa03b47c3fc21c7e">get_data_path</a>(self, opt):</div><div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Determines path to the data file.&quot;&quot;&quot;</span></div><div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;        task_name = opt[<span class="stringliteral">&#39;task&#39;</span>].split(<span class="stringliteral">&#39;:&#39;</span>)[1] <span class="keywordflow">if</span> <span class="stringliteral">&#39;:&#39;</span> <span class="keywordflow">in</span> opt[<span class="stringliteral">&#39;task&#39;</span>] <span class="keywordflow">else</span> opt[<span class="stringliteral">&#39;task&#39;</span>]</div><div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        data_path = os.path.join(opt[<span class="stringliteral">&#39;datapath&#39;</span>], task_name)</div><div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;        <span class="keywordflow">return</span> data_path</div><div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;</div><div class="line"><a name="l01427"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a22a280003b7f4202e0d917040bd56eb8"> 1427</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a22a280003b7f4202e0d917040bd56eb8">get_image_path</a>(self, opt):</div><div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;<span class="stringliteral">        Return the path to the data directory and to the image directory.</span></div><div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;<span class="stringliteral">        Is based on opt fields: task, datatype (train, valid, test), datapath.</span></div><div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="stringliteral">        Subclass can override this.</span></div><div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        data_path = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aa3c1da773025838ffa03b47c3fc21c7e">get_data_path</a>(opt)</div><div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;        <span class="keywordflow">if</span> opt.get(<span class="stringliteral">&#39;image_path&#39;</span>, <span class="keywordtype">None</span>):</div><div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;            image_path = opt[<span class="stringliteral">&#39;image_path&#39;</span>]</div><div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;            <span class="comment"># other common choice: .join(opt[&#39;datapath&#39;], task_name + &#39;_images&#39;)</span></div><div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;            image_path = os.path.join(data_path, <span class="stringliteral">&#39;images&#39;</span>)</div><div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;</div><div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;        <span class="keywordflow">return</span> image_path</div><div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;</div><div class="line"><a name="l01444"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a29fce019ea9795947235ba208aa4bfb0"> 1444</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a29fce019ea9795947235ba208aa4bfb0">get_image_features_path</a>(self, task, image_model_name, dt):</div><div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;<span class="stringliteral">        Image features for the dataset images are stored here.</span></div><div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;<span class="stringliteral">        Can be overriden in subclass to use custom paths.</span></div><div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;<span class="stringliteral">        Image features can be manually copied into this directory or in the</span></div><div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;<span class="stringliteral">        case of ImageLoader eligible models, they will be built and stored here if not already there.</span></div><div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        <span class="comment"># In default implementation, self.data_path already has task name added</span></div><div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;        image_features_path = os.path.join(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a9fb2d3ab4b52f70872460c624bad1218">data_path</a>, <span class="stringliteral">&#39;image_features&#39;</span>)</div><div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;</div><div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.isdir(image_features_path):</div><div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;            os.makedirs(image_features_path)</div><div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;</div><div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        <span class="keywordflow">return</span> os.path.join(</div><div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;            image_features_path, <span class="stringliteral">&#39;%s_%s_%s_features_dict&#39;</span> % (task, image_model_name, dt)</div><div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;        )</div><div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;</div><div class="line"><a name="l01463"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a16c2be0ffe61e136dea2a63cbd918af5"> 1463</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a16c2be0ffe61e136dea2a63cbd918af5">is_image_mode_buildable</a>(self, model_name):</div><div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;<span class="stringliteral">        Is buildable if features can be calculated by ImageLoader.</span></div><div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;<span class="stringliteral">        Users may wish to compute features for the dataset offline and use in</span></div><div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;<span class="stringliteral">        the model, in which case, the image model should return False and</span></div><div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="stringliteral">        get_image_features() should be overriden in subclass.</span></div><div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;        <span class="keywordflow">return</span> model_name <span class="keywordflow">in</span> ImageLoader.get_available_model_names()</div><div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;</div><div class="line"><a name="l01473"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ad110a80a077e9e1135d4241083786199"> 1473</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ad110a80a077e9e1135d4241083786199">load_data</a>(self, data_path, opt):</div><div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;<span class="stringliteral">        Loading the data file, which is the index to the images and text.</span></div><div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;<span class="stringliteral">        It is often a .json file with the name of the &lt;datatype&gt;.json (i.e.</span></div><div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="stringliteral">        train.json). Stores in self.data.</span></div><div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;<span class="stringliteral">        Can be override by subclass.</span></div><div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;</div><div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;        dt = opt[<span class="stringliteral">&#39;datatype&#39;</span>].split(<span class="stringliteral">&#39;:&#39;</span>)[0]</div><div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;</div><div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        <span class="comment"># Sometimes file is named &quot;val&quot; instead of &quot;valid&quot;</span></div><div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        <span class="keywordflow">if</span> dt <span class="keywordflow">not</span> <span class="keywordflow">in</span> [<span class="stringliteral">&#39;train&#39;</span>, <span class="stringliteral">&#39;valid&#39;</span>, <span class="stringliteral">&#39;val&#39;</span>, <span class="stringliteral">&#39;test&#39;</span>]:</div><div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;            <span class="keywordflow">raise</span> Exception(</div><div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;                <span class="stringliteral">&#39;Unknown dt parameter: %s. Expected either &quot;train&quot;, &quot;valid&quot;, or &quot;test&quot;.&#39;</span></div><div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;                % dt</div><div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;            )</div><div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;</div><div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        <span class="comment"># Assumes file is train.json or valid.json named</span></div><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        data_file = os.path.join(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a9fb2d3ab4b52f70872460c624bad1218">data_path</a>, <span class="stringliteral">&#39;%s.json&#39;</span> % dt)</div><div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;</div><div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;        <span class="comment"># Load the text data and image number indexes</span></div><div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;        with open(data_file) <span class="keyword">as</span> f:</div><div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a4015f3b73718e13896bb464378a269f1">data</a> = json.load(f)</div><div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;</div><div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;        <span class="keywordflow">if</span> len(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a4015f3b73718e13896bb464378a269f1">data</a>) &gt; 0 <span class="keywordflow">and</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ada83f1832b7c75f9daab8e4d196ba893">image_id_key</a> <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a4015f3b73718e13896bb464378a269f1">data</a>[0]:</div><div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;            <span class="comment"># Data doesn&#39;t have a &quot;image_id&quot; like field so add the index in the file to the data</span></div><div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;            <span class="keywordflow">for</span> idx, d <span class="keywordflow">in</span> enumerate(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a4015f3b73718e13896bb464378a269f1">data</a>):</div><div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;                d[self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ada83f1832b7c75f9daab8e4d196ba893">image_id_key</a>] = idx</div><div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;</div><div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a4015f3b73718e13896bb464378a269f1">data</a></div><div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;</div><div class="line"><a name="l01506"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aa6ac386d509d428870124c27265363bb"> 1506</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aa6ac386d509d428870124c27265363bb">setup_image_features</a>(self, data_path):</div><div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="stringliteral">        Load text and image data.</span></div><div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="stringliteral">        The image features all live in dicts by default in &lt;data_path&gt;/</span></div><div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="stringliteral">        image_features/ but get_image_features_path() above can be overriden by</span></div><div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;<span class="stringliteral">        subclass to put them elsewhere.</span></div><div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;<span class="stringliteral">        In the (very odd) case that the resnet or resnext dicts (models</span></div><div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;<span class="stringliteral">        buildable using ImageLoader) are not found, we build them.</span></div><div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;</div><div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        image_mode_features_dict_path = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a29fce019ea9795947235ba208aa4bfb0">get_image_features_path</a>(</div><div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a78dca77e43183d22d75140ca113d821c">task</a>, self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a72abb2921076e7597cc946275983028b">image_mode</a>, self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a65c9039b783299ad6033ccbb995ca493">datatype</a></div><div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;        )</div><div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;</div><div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        <span class="keywordflow">if</span> os.path.isfile(image_mode_features_dict_path):</div><div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;            print(</div><div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;                f<span class="stringliteral">&#39;Loading existing image features dict for model: {self.image_mode} at: {image_mode_features_dict_path}&#39;</span></div><div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;            )</div><div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;            self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a67fc5068ab7e2c1c718614cc737d6a75">image_features_dict</a> = torch.load(</div><div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;                image_mode_features_dict_path, map_location=<span class="stringliteral">&#39;cpu&#39;</span></div><div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;            )</div><div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;            print(f<span class="stringliteral">&#39;No existing image features, attempting to build.&#39;</span>)</div><div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a16c2be0ffe61e136dea2a63cbd918af5">is_image_mode_buildable</a>(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a72abb2921076e7597cc946275983028b">image_mode</a>):</div><div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;                <span class="comment"># TODO: Awkward to modify the input opt but needed to use</span></div><div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;                <span class="comment"># TODO: ImageLoader functionality. Is from comment_battle,</span></div><div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;                <span class="comment"># TODO: will refactor this at some point soon most likely</span></div><div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;                image_loader_opt = self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Agent.html#ab3b45d2754244608c75d4068b90cd051">opt</a>.copy()</div><div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;                image_loader_opt[<span class="stringliteral">&#39;image_mode&#39;</span>] = (</div><div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;                    self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a72abb2921076e7597cc946275983028b">image_mode</a> <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a0e4ee3692e19e0f1df2fef8f21d058ab">include_image</a> <span class="keywordflow">else</span> <span class="stringliteral">&#39;none&#39;</span></div><div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;                )</div><div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;</div><div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;                image_loader_opt[<span class="stringliteral">&#39;image_size&#39;</span>] = 256</div><div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;                image_loader_opt[<span class="stringliteral">&#39;image_cropsize&#39;</span>] = 224</div><div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aaf426bd12c83e8f8d5a217481cbf854b">image_loader</a> = <a class="code" href="classparlai_1_1core_1_1image__featurizers_1_1ImageLoader.html">ImageLoader</a>(image_loader_opt)</div><div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;</div><div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;                <span class="comment"># try to build with ImageLoader (i.e. resenet/resnext variants)</span></div><div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a67fc5068ab7e2c1c718614cc737d6a75">image_features_dict</a> = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ad50dcf379a43d371f9763d5f45a4f5d8">_build_image_features_dict</a>(</div><div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;                    self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a9fb2d3ab4b52f70872460c624bad1218">data_path</a>, self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a65c9039b783299ad6033ccbb995ca493">datatype</a>, image_mode_features_dict_path</div><div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;                )</div><div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;                <span class="keywordflow">raise</span> RuntimeError(</div><div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;                    <span class="stringliteral">&#39;Image model: %s is not buildable by ImageLoader but does&#39;</span></div><div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;                    <span class="stringliteral">&#39;not already exist on disk as an image features dict for&#39;</span></div><div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;                    <span class="stringliteral">&#39;this dataset.&#39;</span> % self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a72abb2921076e7597cc946275983028b">image_mode</a></div><div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;                )</div><div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;</div><div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    <span class="keyword">def </span>_build_image_features_dict(self, data_path, dt, store_dict_path):</div><div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;<span class="stringliteral">        Build resne(x)t image features with ImageLoader.</span></div><div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;<span class="stringliteral">        (Or anything handleable by ImageLoader) and save to path.</span></div><div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;<span class="stringliteral">        Only called if we haven&#39;t already built the dict before.</span></div><div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;        image_features_dict = {}</div><div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;        total = len(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a4015f3b73718e13896bb464378a269f1">data</a>)</div><div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;        <span class="keyword">import</span> tqdm</div><div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;</div><div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        pbar = tqdm.tqdm(</div><div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;            total=total,</div><div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160;            unit=<span class="stringliteral">&#39;cand&#39;</span>,</div><div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;            unit_scale=<span class="keyword">True</span>,</div><div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;            desc=<span class="stringliteral">&#39;Building image features dict for %s with ImageLoader.&#39;</span></div><div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;            % self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a72abb2921076e7597cc946275983028b">image_mode</a>,</div><div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;        )</div><div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;        num = 0</div><div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;        <span class="keywordflow">for</span> ex <span class="keywordflow">in</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a4015f3b73718e13896bb464378a269f1">data</a>:</div><div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160;            img_id = ex[self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ada83f1832b7c75f9daab8e4d196ba893">image_id_key</a>]</div><div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;            img_path = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aa75286450850638274d7f076a81f7e90">image_id_to_image_path</a>(img_id)</div><div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;            image = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aaf426bd12c83e8f8d5a217481cbf854b">image_loader</a>.load(img_path).detach()</div><div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;            image = image[0, :, 0, 0]</div><div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;            image_features_dict[img_id] = image</div><div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;            num += 1</div><div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;            pbar.update(1)</div><div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;            <span class="keywordflow">if</span> num % 1000 == 0:</div><div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;                print(f<span class="stringliteral">&#39;Processing image index: {num}&#39;</span>)</div><div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;        torch.save(image_features_dict, store_dict_path)</div><div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;        <span class="keywordflow">return</span> image_features_dict</div><div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;</div><div class="line"><a name="l01588"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a13b4576dd3a045944ff1b44cb88a2764"> 1588</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a13b4576dd3a045944ff1b44cb88a2764">reset</a>(self):</div><div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;        super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a13b4576dd3a045944ff1b44cb88a2764">reset</a>()</div><div class="line"><a name="l01590"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a404b2e622780e94083ba9539ebaab609"> 1590</a></span>&#160;        self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a404b2e622780e94083ba9539ebaab609">example</a> = <span class="keywordtype">None</span></div><div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;</div><div class="line"><a name="l01592"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a702999efa941a59854ee511fc99cd117"> 1592</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a702999efa941a59854ee511fc99cd117">num_episodes</a>(self):</div><div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        <span class="keywordflow">return</span> self.<a class="code" href="classparlai_1_1core_1_1agents_1_1Teacher.html#a93370e4e99236e8ad267b40cd4437920">num_examples</a>()</div><div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;</div><div class="line"><a name="l01595"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a4f5565f49b0aef6d084257b5090a7e40"> 1595</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a4f5565f49b0aef6d084257b5090a7e40">num_examples</a>(self):</div><div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;        <span class="keywordflow">return</span> len(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a4015f3b73718e13896bb464378a269f1">data</a>)</div><div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;</div><div class="line"><a name="l01598"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a3e1f85a8de230d8733272bd1e860cd92"> 1598</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a3e1f85a8de230d8733272bd1e860cd92">get_image_features</a>(self, example):</div><div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;<span class="stringliteral">        Get image features for example</span></div><div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;<span class="stringliteral">        Can be overrided in subclass for different behavior.</span></div><div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;<span class="stringliteral">        For large datasets, it may be more appropriate to use the</span></div><div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;<span class="stringliteral">        ImageLoader.load() method to load image features (as this is essentially</span></div><div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;<span class="stringliteral">        streaming the features from disk, so that we do not have to load a</span></div><div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;<span class="stringliteral">        large image feature dict in memory).</span></div><div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;<span class="stringliteral">        #TODO Could be the default option if we are using -dt train:stream</span></div><div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;</div><div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        key = <a class="code" href="namespacegenerate__task__READMEs.html#a5b88452ffb87b78c8c85ececebafc09f">str</a>(example[self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ada83f1832b7c75f9daab8e4d196ba893">image_id_key</a>])</div><div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;        <span class="keywordflow">if</span> <span class="keywordflow">not</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a0e4ee3692e19e0f1df2fef8f21d058ab">include_image</a> <span class="keywordflow">or</span> key <span class="keywordflow">not</span> <span class="keywordflow">in</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a67fc5068ab7e2c1c718614cc737d6a75">image_features_dict</a>:</div><div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160;            image_features = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a0c48c489fee91d94cf8d62b902bd6b27">blank_image_features</a></div><div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;            image_features = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a67fc5068ab7e2c1c718614cc737d6a75">image_features_dict</a>[key]</div><div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        <span class="keywordflow">return</span> image_features</div><div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;</div><div class="line"><a name="l01617"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ae2f395708462355b28888be7a434ebf4"> 1617</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ae2f395708462355b28888be7a434ebf4">get</a>(self, episode_idx, entry_idx=0):</div><div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;</span></div><div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;<span class="stringliteral">        Override this in subclass if your data should be handled in a</span></div><div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;<span class="stringliteral">        different format</span></div><div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;        example = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a4015f3b73718e13896bb464378a269f1">data</a>[episode_idx]</div><div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;        image_features = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a3e1f85a8de230d8733272bd1e860cd92">get_image_features</a>(example)</div><div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;        <span class="keywordflow">return</span> {</div><div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;            <span class="stringliteral">&#39;labels&#39;</span>: [example[self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a95e578f9650f77c1d397319b9050af51">text_key</a>]],</div><div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;            <span class="stringliteral">&#39;image&#39;</span>: image_features,</div><div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;            <span class="stringliteral">&#39;episode_idx&#39;</span>: episode_idx,</div><div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;            <span class="stringliteral">&#39;episode_done&#39;</span>: <span class="keyword">True</span>,</div><div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;        }</div><div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;</div><div class="line"><a name="l01631"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ae519608a207d86bd7801f3043ff0ebf5"> 1631</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ae519608a207d86bd7801f3043ff0ebf5">next_example</a>(self):</div><div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;        <span class="stringliteral">&quot;&quot;&quot;Load queued example</span></div><div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;<span class="stringliteral"></span></div><div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;<span class="stringliteral">        When self.image_features_dict is not `none`, this is essentially a</span></div><div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;<span class="stringliteral">        no-op. However, this is necessary/useful if self.image_mode is e.g. raw</span></div><div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;<span class="stringliteral">        or ascii.</span></div><div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;<span class="stringliteral">        &quot;&quot;&quot;</span></div><div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;        return_result = <span class="keywordtype">None</span></div><div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a0e4ee3692e19e0f1df2fef8f21d058ab">include_image</a>:</div><div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;            <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a67fc5068ab7e2c1c718614cc737d6a75">image_features_dict</a> <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;                <span class="comment"># We have specified an image model and it uses image features either</span></div><div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;                <span class="comment"># generated by ImageLoader or by pre-computation and manually</span></div><div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;                <span class="comment"># placed on path</span></div><div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;                return_result = super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ae519608a207d86bd7801f3043ff0ebf5">next_example</a>()</div><div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;            <span class="keywordflow">else</span>:</div><div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;                <span class="comment"># We have specified an image model/mode but it&#39;s not based on</span></div><div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;                <span class="comment"># calculating features, (e.g. &quot;raw&quot; or &quot;ascii&quot;) so we try to load</span></div><div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;                <span class="comment"># the image from the DataLoader</span></div><div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;                <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a404b2e622780e94083ba9539ebaab609">example</a> <span class="keywordflow">is</span> <span class="keywordflow">not</span> <span class="keywordtype">None</span>:</div><div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;                    <span class="comment"># Move the image we previously loaded in the background via</span></div><div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;                    <span class="comment"># the DataLoader into the example</span></div><div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;                    image = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a59d9cf6a9e7f64a5d9a8d180ed06c001">data_queue</a>.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ae2f395708462355b28888be7a434ebf4">get</a>()</div><div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;                    self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a404b2e622780e94083ba9539ebaab609">example</a>[<span class="stringliteral">&#39;image&#39;</span>] = image</div><div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;                    return_result = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a404b2e622780e94083ba9539ebaab609">example</a>, self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a5e814d24d81975556ee474c89d5fee5a">imageEpochDone</a></div><div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;                <span class="keywordflow">else</span>:</div><div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;                    return_result = super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ae519608a207d86bd7801f3043ff0ebf5">next_example</a>()</div><div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;</div><div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;                <span class="comment"># Now, get next base example and put it to load in the background</span></div><div class="line"><a name="l01659"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a5e814d24d81975556ee474c89d5fee5a"> 1659</a></span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a404b2e622780e94083ba9539ebaab609">example</a>, self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a5e814d24d81975556ee474c89d5fee5a">imageEpochDone</a> = super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ae519608a207d86bd7801f3043ff0ebf5">next_example</a>()</div><div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;                img_path = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aa75286450850638274d7f076a81f7e90">image_id_to_image_path</a>(self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a404b2e622780e94083ba9539ebaab609">example</a>[<span class="stringliteral">&#39;image_id&#39;</span>])</div><div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;                self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7edc6520195726382082a76486fa3747">data_loader</a>.request_load(</div><div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;                    self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a001ed7924490d0e291588c54d383384a">receive_data</a>, self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aaf426bd12c83e8f8d5a217481cbf854b">image_loader</a>.load, (img_path,)</div><div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;                )</div><div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        <span class="keywordflow">else</span>:</div><div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;            <span class="comment"># No image model specified</span></div><div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;            return_result = super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ae519608a207d86bd7801f3043ff0ebf5">next_example</a>()</div><div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;        <span class="keywordflow">if</span> self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a30c5880e14b65476ed8d9e6d63e04b2f">__verbose</a>:</div><div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;            print(f<span class="stringliteral">&#39;AbstractImageTeacher - next_example(): {return_result}&#39;</span>)</div><div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;        <span class="keywordflow">return</span> return_result</div><div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;</div><div class="line"><a name="l01671"></a><span class="lineno"><a class="line" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a6095f493a108e30fcf22d36c146cdb8e"> 1671</a></span>&#160;    <span class="keyword">def </span><a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a6095f493a108e30fcf22d36c146cdb8e">share</a>(self):</div><div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        shared = super().<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a6095f493a108e30fcf22d36c146cdb8e">share</a>()</div><div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;        shared[<span class="stringliteral">&#39;data&#39;</span>] = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a4015f3b73718e13896bb464378a269f1">data</a></div><div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;        shared[<span class="stringliteral">&#39;image_loader&#39;</span>] = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aaf426bd12c83e8f8d5a217481cbf854b">image_loader</a></div><div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;        <span class="keywordflow">if</span> hasattr(self, <span class="stringliteral">&#39;image_features_dict&#39;</span>):</div><div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;            shared[<span class="stringliteral">&#39;image_features_dict&#39;</span>] = self.<a class="code" href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a67fc5068ab7e2c1c718614cc737d6a75">image_features_dict</a></div><div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;        <span class="keywordflow">return</span> shared</div><div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogTeacher_html_a738c4571db2fee7ce3ab01072f10ed49"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a738c4571db2fee7ce3ab01072f10ed49">parlai.core.teachers.DialogTeacher.next_example</a></div><div class="ttdeci">def next_example(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00514">teachers.py:514</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a49100faf9af79c6e24ddac9e36151d54"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a49100faf9af79c6e24ddac9e36151d54">parlai.core.teachers.FixedDialogTeacher.next_batch</a></div><div class="ttdeci">def next_batch(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00296">teachers.py:296</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a7c4cbfbe5cf6e9dbdf8c00d140ef4e7e"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7c4cbfbe5cf6e9dbdf8c00d140ef4e7e">parlai.core.teachers.FixedDialogTeacher.get</a></div><div class="ttdeci">def get(self, episode_idx, entry_idx=0)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00332">teachers.py:332</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a9fb2d3ab4b52f70872460c624bad1218"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a9fb2d3ab4b52f70872460c624bad1218">parlai.core.teachers.AbstractImageTeacher.data_path</a></div><div class="ttdeci">data_path</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01296">teachers.py:1296</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DataLoader_html"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DataLoader.html">parlai.core.teachers.DataLoader</a></div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00056">teachers.py:56</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_a6375bd13d685da4b3449caaafcc5ec13"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a6375bd13d685da4b3449caaafcc5ec13">parlai.core.teachers.StreamDialogData.reset</a></div><div class="ttdeci">def reset(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00911">teachers.py:911</a></div></div>
<div class="ttc" id="namespaceparlai_1_1utils_1_1misc_html_a1b053cd9c56e6fa79b058fff587b3a48"><div class="ttname"><a href="namespaceparlai_1_1utils_1_1misc.html#a1b053cd9c56e6fa79b058fff587b3a48">parlai.utils.misc.str_to_msg</a></div><div class="ttdeci">def str_to_msg(txt, ignore_fields='')</div><div class="ttdef"><b>Definition:</b> <a href="misc_8py_source.html#l00715">misc.py:715</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogTeacher_html_a9385b9ae914ef84be6b54107811b202b"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a9385b9ae914ef84be6b54107811b202b">parlai.core.teachers.DialogTeacher.__init__</a></div><div class="ttdeci">def __init__(self, opt, shared=None)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00437">teachers.py:437</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogData_html_a21822d2d86e26a27bdc8326b48ebc9b9"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a21822d2d86e26a27bdc8326b48ebc9b9">parlai.core.teachers.DialogData.cands</a></div><div class="ttdeci">cands</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00570">teachers.py:570</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher_html_ae6f10486ddf691ee868d33ea2c9dc295"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#ae6f10486ddf691ee868d33ea2c9dc295">parlai.core.teachers.FbDialogTeacher.load_cands</a></div><div class="ttdeci">def load_cands(self, path)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01005">teachers.py:1005</a></div></div>
<div class="ttc" id="namespacemake__control__dataset_html_aab4734ca3fc74fda1c53ad21ec9f47b0"><div class="ttname"><a href="namespacemake__control__dataset.html#aab4734ca3fc74fda1c53ad21ec9f47b0">make_control_dataset.float</a></div><div class="ttdeci">float</div><div class="ttdef"><b>Definition:</b> <a href="make__control__dataset_8py_source.html#l00117">make_control_dataset.py:117</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a32febe29909f7523b0d7b5ee7335fd05"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a32febe29909f7523b0d7b5ee7335fd05">parlai.core.teachers.FixedDialogTeacher.observe</a></div><div class="ttdeci">def observe(self, observation)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00348">teachers.py:348</a></div></div>
<div class="ttc" id="namespaceparlai_1_1core_1_1agents_html"><div class="ttname"><a href="namespaceparlai_1_1core_1_1agents.html">parlai.core.agents</a></div><div class="ttdef"><b>Definition:</b> <a href="parlai_2core_2agents_8py_source.html#l00001">agents.py:1</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DataLoader_html_af06f90bbe1a2d310ac43e963c2eb8f88"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DataLoader.html#af06f90bbe1a2d310ac43e963c2eb8f88">parlai.core.teachers.DataLoader.__init__</a></div><div class="ttdeci">def __init__(self, opt)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00066">teachers.py:66</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_af41dd0f335bb24f499376f0b55ebea93"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#af41dd0f335bb24f499376f0b55ebea93">parlai.core.teachers.StreamDialogData.cycle</a></div><div class="ttdeci">cycle</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00782">teachers.py:782</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_ae054596c459b22bbeacf622a5208b785"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#ae054596c459b22bbeacf622a5208b785">parlai.core.teachers.StreamDialogData.reset_data</a></div><div class="ttdeci">reset_data</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00785">teachers.py:785</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher_html_a18a4ea7a7f21eeed7e087cb447a37c5a"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a18a4ea7a7f21eeed7e087cb447a37c5a">parlai.core.teachers.FbDialogTeacher.share</a></div><div class="ttdeci">def share(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00995">teachers.py:995</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogTeacher_html_a393f94ea28e1733f575a9f36a0b43c18"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a393f94ea28e1733f575a9f36a0b43c18">parlai.core.teachers.DialogTeacher.reset</a></div><div class="ttdeci">def reset(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00468">teachers.py:468</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_a05f4816d029700a4bf9fd1eeafcb527c"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a05f4816d029700a4bf9fd1eeafcb527c">parlai.core.teachers.StreamDialogData.num_episodes</a></div><div class="ttdeci">def num_episodes(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00863">teachers.py:863</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_aa6ac386d509d428870124c27265363bb"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aa6ac386d509d428870124c27265363bb">parlai.core.teachers.AbstractImageTeacher.setup_image_features</a></div><div class="ttdeci">def setup_image_features(self, data_path)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01506">teachers.py:1506</a></div></div>
<div class="ttc" id="namespaceparlai_1_1utils_1_1misc_html_a38a23cfa0fc3dbed42846787d1c04b57"><div class="ttname"><a href="namespaceparlai_1_1utils_1_1misc.html#a38a23cfa0fc3dbed42846787d1c04b57">parlai.utils.misc.no_lock</a></div><div class="ttdeci">def no_lock()</div><div class="ttdef"><b>Definition:</b> <a href="misc_8py_source.html#l00440">misc.py:440</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_adbbee971d8b6eabae13165060e901c40"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#adbbee971d8b6eabae13165060e901c40">parlai.core.teachers.FixedDialogTeacher.__init__</a></div><div class="ttdeci">def __init__(self, opt, shared=None)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00145">teachers.py:145</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DataLoader_html_a223a0d846ce98840f8f3338611f94d34"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DataLoader.html#a223a0d846ce98840f8f3338611f94d34">parlai.core.teachers.DataLoader.num_workers</a></div><div class="ttdeci">num_workers</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00068">teachers.py:68</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a822d9f5c86ab0b0c608ae26901d3dec3"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a822d9f5c86ab0b0c608ae26901d3dec3">parlai.core.teachers.FixedDialogTeacher.datafile</a></div><div class="ttdeci">datafile</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00155">teachers.py:155</a></div></div>
<div class="ttc" id="namespaceparlai_1_1core_1_1message_html"><div class="ttname"><a href="namespaceparlai_1_1core_1_1message.html">parlai.core.message</a></div><div class="ttdef"><b>Definition:</b> <a href="message_8py_source.html#l00001">message.py:1</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a22a280003b7f4202e0d917040bd56eb8"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a22a280003b7f4202e0d917040bd56eb8">parlai.core.teachers.AbstractImageTeacher.get_image_path</a></div><div class="ttdeci">def get_image_path(self, opt)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01427">teachers.py:1427</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogData_html"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogData.html">parlai.core.teachers.DialogData</a></div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00523">teachers.py:523</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogData_html_a25f9100e2b36edf74528a60533e728e4"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a25f9100e2b36edf74528a60533e728e4">parlai.core.teachers.DialogData.copied_cands</a></div><div class="ttdeci">copied_cands</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00577">teachers.py:577</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_a40ac215e58913119b1406b1d440a55f4"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a40ac215e58913119b1406b1d440a55f4">parlai.core.teachers.StreamDialogData.next_episode</a></div><div class="ttdeci">next_episode</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00804">teachers.py:804</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogData_html_a1e037df2f18a67503db657ae4cc27ab4"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a1e037df2f18a67503db657ae4cc27ab4">parlai.core.teachers.DialogData.get</a></div><div class="ttdeci">def get(self, episode_idx, entry_idx=0)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00684">teachers.py:684</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher_html_ab3ff2f1a0707aae7bf888fb13ec49641"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#ab3ff2f1a0707aae7bf888fb13ec49641">parlai.core.teachers.FbDialogTeacher.label_candidates</a></div><div class="ttdeci">def label_candidates(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01001">teachers.py:1001</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher_html_a3ec67545250d8a877038667e3f4ea158"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a3ec67545250d8a877038667e3f4ea158">parlai.core.teachers.FbDialogTeacher.cands</a></div><div class="ttdeci">cands</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00990">teachers.py:990</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a759b2dcb341b657fda29c71a7a5354b4"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a759b2dcb341b657fda29c71a7a5354b4">parlai.core.teachers.FixedDialogTeacher.act</a></div><div class="ttdeci">def act(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00392">teachers.py:392</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogTeacher_html_a50649105cc9d00bcaa860290d804eac9"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a50649105cc9d00bcaa860290d804eac9">parlai.core.teachers.DialogTeacher.label_candidates</a></div><div class="ttdeci">def label_candidates(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00482">teachers.py:482</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1image__featurizers_1_1ImageLoader_html"><div class="ttname"><a href="classparlai_1_1core_1_1image__featurizers_1_1ImageLoader.html">parlai.core.image_featurizers.ImageLoader</a></div><div class="ttdef"><b>Definition:</b> <a href="image__featurizers_8py_source.html#l00019">image_featurizers.py:19</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_a208467ba7e999efaf5d1d39ef3c060ff"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a208467ba7e999efaf5d1d39ef3c060ff">parlai.core.teachers.StreamDialogData._data_generator</a></div><div class="ttdeci">def _data_generator(self, data_loader, datafile)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00825">teachers.py:825</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1agents_1_1Agent_html_ab3b45d2754244608c75d4068b90cd051"><div class="ttname"><a href="classparlai_1_1core_1_1agents_1_1Agent.html#ab3b45d2754244608c75d4068b90cd051">parlai.core.agents.Agent.opt</a></div><div class="ttdeci">opt</div><div class="ttdef"><b>Definition:</b> <a href="parlai_2core_2agents_8py_source.html#l00060">agents.py:60</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_aff2a7f405e051f014ece5cc124aa170c"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aff2a7f405e051f014ece5cc124aa170c">parlai.core.teachers.AbstractImageTeacher.image_path</a></div><div class="ttdeci">image_path</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01315">teachers.py:1315</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_adcc1f5f967652688ec8dbcfb3abbcaa6"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#adcc1f5f967652688ec8dbcfb3abbcaa6">parlai.core.teachers.StreamDialogData.lock</a></div><div class="ttdeci">lock</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00790">teachers.py:790</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher_html_aee1494d5dd0610530b4b93e56010e6f8"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#aee1494d5dd0610530b4b93e56010e6f8">parlai.core.teachers.ParlAIDialogTeacher.num_episodes</a></div><div class="ttdeci">def num_episodes(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01238">teachers.py:1238</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogTeacher_html_a1988d984bf87370e9a9e58c9b8ca67a8"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a1988d984bf87370e9a9e58c9b8ca67a8">parlai.core.teachers.DialogTeacher.get</a></div><div class="ttdeci">def get(self, episode_idx, entry_idx=0)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00510">teachers.py:510</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_ad110a80a077e9e1135d4241083786199"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ad110a80a077e9e1135d4241083786199">parlai.core.teachers.AbstractImageTeacher.load_data</a></div><div class="ttdeci">def load_data(self, data_path, opt)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01473">teachers.py:1473</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a67fc5068ab7e2c1c718614cc737d6a75"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a67fc5068ab7e2c1c718614cc737d6a75">parlai.core.teachers.AbstractImageTeacher.image_features_dict</a></div><div class="ttdeci">image_features_dict</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01317">teachers.py:1317</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a51e3463e7b7b44a6ea8b43fc82aacb75"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a51e3463e7b7b44a6ea8b43fc82aacb75">parlai.core.teachers.FixedDialogTeacher.num_episodes</a></div><div class="ttdeci">def num_episodes(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00317">teachers.py:317</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher_html_a37c1c62c52860da9c63d9f6ed23ae6ae"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a37c1c62c52860da9c63d9f6ed23ae6ae">parlai.core.teachers.ParlAIDialogTeacher.num_examples</a></div><div class="ttdeci">def num_examples(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01234">teachers.py:1234</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a8923ee1255939443c7a6ea1532a2fe40"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a8923ee1255939443c7a6ea1532a2fe40">parlai.core.teachers.FixedDialogTeacher.submit_load_request</a></div><div class="ttdeci">def submit_load_request(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00197">teachers.py:197</a></div></div>
<div class="ttc" id="namespaceparlai_1_1core_1_1image__featurizers_html"><div class="ttname"><a href="namespaceparlai_1_1core_1_1image__featurizers.html">parlai.core.image_featurizers</a></div><div class="ttdef"><b>Definition:</b> <a href="image__featurizers_8py_source.html#l00001">image_featurizers.py:1</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher_html_a92fb71aa4e5d3a4751d78ecca202c608"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a92fb71aa4e5d3a4751d78ecca202c608">parlai.core.teachers.ParlAIDialogTeacher._setup_data</a></div><div class="ttdeci">def _setup_data(self, path)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01246">teachers.py:1246</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a708601003f79d10c98a1933501ce658f"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a708601003f79d10c98a1933501ce658f">parlai.core.teachers.AbstractImageTeacher.image_features_dim</a></div><div class="ttdeci">image_features_dim</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01320">teachers.py:1320</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_afd4ebab8063eb42d182d30a1a41f133e"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#afd4ebab8063eb42d182d30a1a41f133e">parlai.core.teachers.FixedDialogTeacher.episode_idx</a></div><div class="ttdeci">episode_idx</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00193">teachers.py:193</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a2735899e5787c14da39443179db6c84b"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a2735899e5787c14da39443179db6c84b">parlai.core.teachers.AbstractImageTeacher.add_cmdline_args</a></div><div class="ttdeci">def add_cmdline_args(cls, argparser)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01372">teachers.py:1372</a></div></div>
<div class="ttc" id="namespacegenerate__task__READMEs_html_a5b88452ffb87b78c8c85ececebafc09f"><div class="ttname"><a href="namespacegenerate__task__READMEs.html#a5b88452ffb87b78c8c85ececebafc09f">generate_task_READMEs.str</a></div><div class="ttdeci">string str</div><div class="ttdef"><b>Definition:</b> <a href="generate__task__READMEs_8py_source.html#l00022">generate_task_READMEs.py:22</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_af64b55521fe587c17696b0b805a2b0d4"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#af64b55521fe587c17696b0b805a2b0d4">parlai.core.teachers.FixedDialogTeacher.training</a></div><div class="ttdeci">training</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00153">teachers.py:153</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher_html_accef414b3b1e708e7dd71a3e1871261f"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#accef414b3b1e708e7dd71a3e1871261f">parlai.core.teachers.ParlAIDialogTeacher.num_exs</a></div><div class="ttdeci">num_exs</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01219">teachers.py:1219</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogData_html_a8deee9e9e45ae8162270bdcdfd7916b6"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a8deee9e9e45ae8162270bdcdfd7916b6">parlai.core.teachers.DialogData.num_examples</a></div><div class="ttdeci">def num_examples(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00676">teachers.py:676</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a001ed7924490d0e291588c54d383384a"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a001ed7924490d0e291588c54d383384a">parlai.core.teachers.FixedDialogTeacher.receive_data</a></div><div class="ttdeci">def receive_data(self, future)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00210">teachers.py:210</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher_html_a52316baa31ca0881d4cd98ec2fbebad5"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a52316baa31ca0881d4cd98ec2fbebad5">parlai.core.teachers.FbDialogTeacher.__init__</a></div><div class="ttdeci">def __init__(self, opt, shared=None)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00986">teachers.py:986</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher_html_ad79a47d28e60c24df72b8523aff6b247"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#ad79a47d28e60c24df72b8523aff6b247">parlai.core.teachers.ParlAIDialogTeacher.__init__</a></div><div class="ttdeci">def __init__(self, opt, shared=None)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01215">teachers.py:1215</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_a35ddb652bb3255dba53d5fd69046ebb7"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a35ddb652bb3255dba53d5fd69046ebb7">parlai.core.teachers.StreamDialogData.data_loader</a></div><div class="ttdeci">data_loader</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00788">teachers.py:788</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1agents_1_1Agent_html_a29e1cdd729ac4236f8bae90b2e66fa04"><div class="ttname"><a href="classparlai_1_1core_1_1agents_1_1Agent.html#a29e1cdd729ac4236f8bae90b2e66fa04">parlai.core.agents.Agent.getID</a></div><div class="ttdeci">def getID(self)</div><div class="ttdef"><b>Definition:</b> <a href="parlai_2core_2agents_8py_source.html#l00080">agents.py:80</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_a72324ec2775d16b31d1d18287a8f84e9"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a72324ec2775d16b31d1d18287a8f84e9">parlai.core.teachers.StreamDialogData.__init__</a></div><div class="ttdeci">def __init__(self, opt, data_loader=None, cands=None, shared=None, kwargs)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00779">teachers.py:779</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_aa3c1da773025838ffa03b47c3fc21c7e"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aa3c1da773025838ffa03b47c3fc21c7e">parlai.core.teachers.AbstractImageTeacher.get_data_path</a></div><div class="ttdeci">def get_data_path(self, opt)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01421">teachers.py:1421</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogTeacher_html"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html">parlai.core.teachers.DialogTeacher</a></div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00420">teachers.py:420</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_aab36cededc1817fee5109293bd62c51d"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aab36cededc1817fee5109293bd62c51d">parlai.core.teachers.AbstractImageTeacher.__init__</a></div><div class="ttdeci">def __init__(self, opt, shared=None)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01292">teachers.py:1292</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_a6aa5dc9644a792b801bc7cf69a194ae6"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a6aa5dc9644a792b801bc7cf69a194ae6">parlai.core.teachers.StreamDialogData.num_exs</a></div><div class="ttdeci">num_exs</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00806">teachers.py:806</a></div></div>
<div class="ttc" id="namespaceparlai_1_1utils_1_1misc_html_acf146e70ea7f6867969a7c2b545d4b4b"><div class="ttname"><a href="namespaceparlai_1_1utils_1_1misc.html#acf146e70ea7f6867969a7c2b545d4b4b">parlai.utils.misc.warn_once</a></div><div class="ttdeci">def warn_once(msg, warningtype=None)</div><div class="ttdef"><b>Definition:</b> <a href="misc_8py_source.html#l00992">misc.py:992</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a59d9cf6a9e7f64a5d9a8d180ed06c001"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a59d9cf6a9e7f64a5d9a8d180ed06c001">parlai.core.teachers.FixedDialogTeacher.data_queue</a></div><div class="ttdeci">data_queue</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00157">teachers.py:157</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_ae2f395708462355b28888be7a434ebf4"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ae2f395708462355b28888be7a434ebf4">parlai.core.teachers.AbstractImageTeacher.get</a></div><div class="ttdeci">def get(self, episode_idx, entry_idx=0)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01617">teachers.py:1617</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher_html"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html">parlai.core.teachers.ParlAIDialogTeacher</a></div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01157">teachers.py:1157</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1agents_1_1Teacher_html_a159705efe2a9f389d8adfdad76891f08"><div class="ttname"><a href="classparlai_1_1core_1_1agents_1_1Teacher.html#a159705efe2a9f389d8adfdad76891f08">parlai.core.agents.Teacher.metrics</a></div><div class="ttdeci">metrics</div><div class="ttdef"><b>Definition:</b> <a href="parlai_2core_2agents_8py_source.html#l00192">agents.py:192</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DataLoader_html_a960bf1159e437cfb304352213df50a8f"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DataLoader.html#a960bf1159e437cfb304352213df50a8f">parlai.core.teachers.DataLoader.request_queue</a></div><div class="ttdeci">request_queue</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00069">teachers.py:69</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a95eb8aeb051fc81a10ac7e1a7d5fed3d"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a95eb8aeb051fc81a10ac7e1a7d5fed3d">parlai.core.teachers.FixedDialogTeacher.examples</a></div><div class="ttdeci">examples</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00165">teachers.py:165</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a0e4ee3692e19e0f1df2fef8f21d058ab"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a0e4ee3692e19e0f1df2fef8f21d058ab">parlai.core.teachers.AbstractImageTeacher.include_image</a></div><div class="ttdeci">include_image</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01313">teachers.py:1313</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a2f6069ff207d360edf2729c245ceaa0f"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a2f6069ff207d360edf2729c245ceaa0f">parlai.core.teachers.FixedDialogTeacher.bsz</a></div><div class="ttdeci">bsz</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00174">teachers.py:174</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a6095f493a108e30fcf22d36c146cdb8e"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a6095f493a108e30fcf22d36c146cdb8e">parlai.core.teachers.AbstractImageTeacher.share</a></div><div class="ttdeci">def share(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01671">teachers.py:1671</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a65c9039b783299ad6033ccbb995ca493"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a65c9039b783299ad6033ccbb995ca493">parlai.core.teachers.FixedDialogTeacher.datatype</a></div><div class="ttdeci">datatype</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00149">teachers.py:149</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a8a551d24fa77a0eb880cbee90b507f7e"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a8a551d24fa77a0eb880cbee90b507f7e">parlai.core.teachers.FixedDialogTeacher.use_batch_act</a></div><div class="ttdeci">use_batch_act</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00176">teachers.py:176</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_a8f5807d28b1b0a4d7eb09ae287b2c01b"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a8f5807d28b1b0a4d7eb09ae287b2c01b">parlai.core.teachers.StreamDialogData.num_eps</a></div><div class="ttdeci">num_eps</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00805">teachers.py:805</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html">parlai.core.teachers.StreamDialogData</a></div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00751">teachers.py:751</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogData_html_aee61e6bc9e80fe0443a7f5322c4ae08d"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogData.html#aee61e6bc9e80fe0443a7f5322c4ae08d">parlai.core.teachers.DialogData.addedCands</a></div><div class="ttdeci">addedCands</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00576">teachers.py:576</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a29fce019ea9795947235ba208aa4bfb0"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a29fce019ea9795947235ba208aa4bfb0">parlai.core.teachers.AbstractImageTeacher.get_image_features_path</a></div><div class="ttdeci">def get_image_features_path(self, task, image_model_name, dt)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01444">teachers.py:1444</a></div></div>
<div class="ttc" id="namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf_html_ad5dfae268e23f506da084a9efb72f619"><div class="ttname"><a href="namespaceparlai_1_1agents_1_1tfidf__retriever_1_1build__tfidf.html#ad5dfae268e23f506da084a9efb72f619">parlai.agents.tfidf_retriever.build_tfidf.type</a></div><div class="ttdeci">type</div><div class="ttdef"><b>Definition:</b> <a href="build__tfidf_8py_source.html#l00326">build_tfidf.py:326</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_ad715c327a4cc7ad3b40a1314157dbc6d"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ad715c327a4cc7ad3b40a1314157dbc6d">parlai.core.teachers.AbstractImageTeacher._validate_image_mode_name</a></div><div class="ttdeci">def _validate_image_mode_name(self, a)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01352">teachers.py:1352</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher_html_a8505bfe962961b04961280a6e4c603f4"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a8505bfe962961b04961280a6e4c603f4">parlai.core.teachers.FbDialogTeacher.cloze</a></div><div class="ttdeci">cloze</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00988">teachers.py:988</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html">parlai.core.teachers.FixedDialogTeacher</a></div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00098">teachers.py:98</a></div></div>
<div class="ttc" id="namespaceparlai_1_1messenger_1_1core_1_1shared__utils_html_a11f2820425bccac8d8d490ab505bcb79"><div class="ttname"><a href="namespaceparlai_1_1messenger_1_1core_1_1shared__utils.html#a11f2820425bccac8d8d490ab505bcb79">parlai.messenger.core.shared_utils.format</a></div><div class="ttdeci">format</div><div class="ttdef"><b>Definition:</b> <a href="messenger_2core_2shared__utils_8py_source.html#l00030">shared_utils.py:30</a></div></div>
<div class="ttc" id="classparlai_1_1utils_1_1misc_1_1AttrDict_html"><div class="ttname"><a href="classparlai_1_1utils_1_1misc_1_1AttrDict.html">parlai.utils.misc.AttrDict</a></div><div class="ttdef"><b>Definition:</b> <a href="misc_8py_source.html#l00379">misc.py:379</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a38bd0d5c98506c45eb87d6db32d1c0bf"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a38bd0d5c98506c45eb87d6db32d1c0bf">parlai.core.teachers.FixedDialogTeacher.num_examples</a></div><div class="ttdeci">def num_examples(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00325">teachers.py:325</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a23f1b4d0d81a1e63ecd8dded6de37578"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a23f1b4d0d81a1e63ecd8dded6de37578">parlai.core.teachers.FixedDialogTeacher._lock</a></div><div class="ttdeci">def _lock(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00178">teachers.py:178</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a468d55710137a42b18f85212d7068c47"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a468d55710137a42b18f85212d7068c47">parlai.core.teachers.FixedDialogTeacher.batchindex</a></div><div class="ttdeci">batchindex</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00175">teachers.py:175</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_ada385b7a8f549f4d65eb910b668c77e5"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#ada385b7a8f549f4d65eb910b668c77e5">parlai.core.teachers.StreamDialogData.num_examples</a></div><div class="ttdeci">def num_examples(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00857">teachers.py:857</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a95e578f9650f77c1d397319b9050af51"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a95e578f9650f77c1d397319b9050af51">parlai.core.teachers.AbstractImageTeacher.text_key</a></div><div class="ttdeci">def text_key(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01404">teachers.py:1404</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_ae3201b15f3c3b46a2f3511bad9b43e7d"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#ae3201b15f3c3b46a2f3511bad9b43e7d">parlai.core.teachers.FixedDialogTeacher.entry_idx</a></div><div class="ttdeci">entry_idx</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00275">teachers.py:275</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_aa6782a610b00aa0675522aa58b03f20c"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#aa6782a610b00aa0675522aa58b03f20c">parlai.core.teachers.FixedDialogTeacher.next_example</a></div><div class="ttdeci">def next_example(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00265">teachers.py:265</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a4015f3b73718e13896bb464378a269f1"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a4015f3b73718e13896bb464378a269f1">parlai.core.teachers.AbstractImageTeacher.data</a></div><div class="ttdeci">data</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01297">teachers.py:1297</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a73ac86c06c926ab7aedd73d49e3bb2b5"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a73ac86c06c926ab7aedd73d49e3bb2b5">parlai.core.teachers.FixedDialogTeacher.index</a></div><div class="ttdeci">index</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00159">teachers.py:159</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a72abb2921076e7597cc946275983028b"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a72abb2921076e7597cc946275983028b">parlai.core.teachers.AbstractImageTeacher.image_mode</a></div><div class="ttdeci">image_mode</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01309">teachers.py:1309</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogTeacher_html_ad90c8cac27f2db22db77e29828b94dfe"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#ad90c8cac27f2db22db77e29828b94dfe">parlai.core.teachers.DialogTeacher.num_examples</a></div><div class="ttdeci">def num_examples(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00503">teachers.py:503</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_a30ca966ffb33e7cbc8f97e9b8837cbc1"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a30ca966ffb33e7cbc8f97e9b8837cbc1">parlai.core.teachers.StreamDialogData.is_reset</a></div><div class="ttdeci">is_reset</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00796">teachers.py:796</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_ada83f1832b7c75f9daab8e4d196ba893"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ada83f1832b7c75f9daab8e4d196ba893">parlai.core.teachers.AbstractImageTeacher.image_id_key</a></div><div class="ttdeci">def image_id_key(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01394">teachers.py:1394</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a13b4576dd3a045944ff1b44cb88a2764"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a13b4576dd3a045944ff1b44cb88a2764">parlai.core.teachers.AbstractImageTeacher.reset</a></div><div class="ttdeci">def reset(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01588">teachers.py:1588</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogTeacher_html_af1e90a07058dc489c45280f0982e21be"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#af1e90a07058dc489c45280f0982e21be">parlai.core.teachers.DialogTeacher.num_episodes</a></div><div class="ttdeci">def num_episodes(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00495">teachers.py:495</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_af239ccfb38c42707c97eb8575fb82f10"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#af239ccfb38c42707c97eb8575fb82f10">parlai.core.teachers.StreamDialogData.entry_idx</a></div><div class="ttdeci">entry_idx</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00803">teachers.py:803</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogTeacher_html_a55fc9dead757489e127ec1a872849376"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a55fc9dead757489e127ec1a872849376">parlai.core.teachers.DialogTeacher.share</a></div><div class="ttdeci">def share(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00475">teachers.py:475</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogData_html_abd563ce3d2e4c105b06a30ef9895c51b"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogData.html#abd563ce3d2e4c105b06a30ef9895c51b">parlai.core.teachers.DialogData._read_episode</a></div><div class="ttdeci">def _read_episode(self, data_loader)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00588">teachers.py:588</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_a5f3e6484038cefcc177a635148f0b492"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a5f3e6484038cefcc177a635148f0b492">parlai.core.teachers.StreamDialogData.load_length</a></div><div class="ttdeci">def load_length(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00835">teachers.py:835</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a4443c43dc20f8f817c8cf28e2d795d6d"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a4443c43dc20f8f817c8cf28e2d795d6d">parlai.core.teachers.FixedDialogTeacher.threadindex</a></div><div class="ttdeci">threadindex</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00163">teachers.py:163</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_a4c7f45ba690d0533d6a8c5c0235155b2"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a4c7f45ba690d0533d6a8c5c0235155b2">parlai.core.teachers.StreamDialogData.datafile</a></div><div class="ttdeci">datafile</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00787">teachers.py:787</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a16c2be0ffe61e136dea2a63cbd918af5"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a16c2be0ffe61e136dea2a63cbd918af5">parlai.core.teachers.AbstractImageTeacher.is_image_mode_buildable</a></div><div class="ttdeci">def is_image_mode_buildable(self, model_name)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01463">teachers.py:1463</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_afa75426a7578e8aad5b74964219345be"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#afa75426a7578e8aad5b74964219345be">parlai.core.teachers.FixedDialogTeacher.batch_act</a></div><div class="ttdeci">def batch_act(self, observations)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00359">teachers.py:359</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a404b2e622780e94083ba9539ebaab609"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a404b2e622780e94083ba9539ebaab609">parlai.core.teachers.AbstractImageTeacher.example</a></div><div class="ttdeci">example</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01590">teachers.py:1590</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a702999efa941a59854ee511fc99cd117"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a702999efa941a59854ee511fc99cd117">parlai.core.teachers.AbstractImageTeacher.num_episodes</a></div><div class="ttdeci">def num_episodes(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01592">teachers.py:1592</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a7edc6520195726382082a76486fa3747"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7edc6520195726382082a76486fa3747">parlai.core.teachers.FixedDialogTeacher.data_loader</a></div><div class="ttdeci">data_loader</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00161">teachers.py:161</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogData_html_aa44f9307c376a1e4bf4697a289db688b"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogData.html#aa44f9307c376a1e4bf4697a289db688b">parlai.core.teachers.DialogData.image_loader</a></div><div class="ttdeci">image_loader</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00568">teachers.py:568</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html">parlai.core.teachers.AbstractImageTeacher</a></div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01266">teachers.py:1266</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogTeacher_html_a82fa5b519a14c4301ce82f6c59c8867a"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a82fa5b519a14c4301ce82f6c59c8867a">parlai.core.teachers.DialogTeacher.stream</a></div><div class="ttdeci">stream</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00450">teachers.py:450</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1agents_1_1Teacher_html_a93370e4e99236e8ad267b40cd4437920"><div class="ttname"><a href="classparlai_1_1core_1_1agents_1_1Teacher.html#a93370e4e99236e8ad267b40cd4437920">parlai.core.agents.Teacher.num_examples</a></div><div class="ttdeci">def num_examples(self)</div><div class="ttdef"><b>Definition:</b> <a href="parlai_2core_2agents_8py_source.html#l00209">agents.py:209</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogData_html_a467bf261c35da2f5d2a34949281d2669"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a467bf261c35da2f5d2a34949281d2669">parlai.core.teachers.DialogData.build_table</a></div><div class="ttdeci">def build_table(self, entry)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00707">teachers.py:707</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_ab64513ca6c2b1c358f180ee0846b26e0"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ab64513ca6c2b1c358f180ee0846b26e0">parlai.core.teachers.AbstractImageTeacher.get_available_image_mode_names</a></div><div class="ttdeci">def get_available_image_mode_names(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01340">teachers.py:1340</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a78dca77e43183d22d75140ca113d821c"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a78dca77e43183d22d75140ca113d821c">parlai.core.teachers.AbstractImageTeacher.task</a></div><div class="ttdeci">task</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01295">teachers.py:1295</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher_html_a0ef5a3bbad31d95bc398a393ab0a310d"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a0ef5a3bbad31d95bc398a393ab0a310d">parlai.core.teachers.ParlAIDialogTeacher.get</a></div><div class="ttdeci">def get(self, episode_idx, entry_idx=None)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01242">teachers.py:1242</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_ae519608a207d86bd7801f3043ff0ebf5"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ae519608a207d86bd7801f3043ff0ebf5">parlai.core.teachers.AbstractImageTeacher.next_example</a></div><div class="ttdeci">def next_example(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01631">teachers.py:1631</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_af0e1160f17d43ace896f71c190e4e5ec"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#af0e1160f17d43ace896f71c190e4e5ec">parlai.core.teachers.FixedDialogTeacher.reset</a></div><div class="ttdeci">def reset(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00184">teachers.py:184</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_aa75286450850638274d7f076a81f7e90"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aa75286450850638274d7f076a81f7e90">parlai.core.teachers.AbstractImageTeacher.image_id_to_image_path</a></div><div class="ttdeci">def image_id_to_image_path(self, image_id)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01413">teachers.py:1413</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_aaf426bd12c83e8f8d5a217481cbf854b"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#aaf426bd12c83e8f8d5a217481cbf854b">parlai.core.teachers.AbstractImageTeacher.image_loader</a></div><div class="ttdeci">image_loader</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01316">teachers.py:1316</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DataLoader_html_a06bfd397f84fd1e2d0d64d64182ae5f5"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DataLoader.html#a06bfd397f84fd1e2d0d64d64182ae5f5">parlai.core.teachers.DataLoader.request_load</a></div><div class="ttdeci">def request_load(self, receive_fn, load_fn, args)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00071">teachers.py:71</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_a6bb0ef8ed4a3360184f715e8fab9b3aa"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a6bb0ef8ed4a3360184f715e8fab9b3aa">parlai.core.teachers.StreamDialogData.share</a></div><div class="ttdeci">def share(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00808">teachers.py:808</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a0c48c489fee91d94cf8d62b902bd6b27"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a0c48c489fee91d94cf8d62b902bd6b27">parlai.core.teachers.AbstractImageTeacher.blank_image_features</a></div><div class="ttdeci">blank_image_features</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01321">teachers.py:1321</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a86428affae9471df880dd5e8dc4b90ed"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a86428affae9471df880dd5e8dc4b90ed">parlai.core.teachers.FixedDialogTeacher.episode_done</a></div><div class="ttdeci">episode_done</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00189">teachers.py:189</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a30c5880e14b65476ed8d9e6d63e04b2f"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a30c5880e14b65476ed8d9e6d63e04b2f">parlai.core.teachers.AbstractImageTeacher.__verbose</a></div><div class="ttdeci">__verbose</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01336">teachers.py:1336</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1agents_1_1Teacher_html"><div class="ttname"><a href="classparlai_1_1core_1_1agents_1_1Teacher.html">parlai.core.agents.Teacher</a></div><div class="ttdef"><b>Definition:</b> <a href="parlai_2core_2agents_8py_source.html#l00178">agents.py:178</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a7fccfc09aef3510f8bb9834398eff8e9"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7fccfc09aef3510f8bb9834398eff8e9">parlai.core.teachers.FixedDialogTeacher.next_episode_idx</a></div><div class="ttdeci">def next_episode_idx(self, num_eps=None, loop=None)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00242">teachers.py:242</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_ad50dcf379a43d371f9763d5f45a4f5d8"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#ad50dcf379a43d371f9763d5f45a4f5d8">parlai.core.teachers.AbstractImageTeacher._build_image_features_dict</a></div><div class="ttdeci">def _build_image_features_dict(self, data_path, dt, store_dict_path)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01555">teachers.py:1555</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher_html_a99d92211286cdcc382f723ebc9d272c4"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a99d92211286cdcc382f723ebc9d272c4">parlai.core.teachers.ParlAIDialogTeacher.episodes</a></div><div class="ttdeci">episodes</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01218">teachers.py:1218</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogData_html_ad57a8129b3109fec84d99de56813b524"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogData.html#ad57a8129b3109fec84d99de56813b524">parlai.core.teachers.DialogData._load</a></div><div class="ttdeci">def _load(self, data_loader, datafile)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00659">teachers.py:659</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher_html_a9e2eabf923a38b53865705786e07f461"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1ParlAIDialogTeacher.html#a9e2eabf923a38b53865705786e07f461">parlai.core.teachers.ParlAIDialogTeacher.share</a></div><div class="ttdeci">def share(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01228">teachers.py:1228</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_a34ba92f60661471fee4eedb5ee2b9eda"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#a34ba92f60661471fee4eedb5ee2b9eda">parlai.core.teachers.StreamDialogData.get</a></div><div class="ttdeci">def get(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00875">teachers.py:875</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1agents_1_1Agent_html_ac00c13f4c7dd1263bf9203fa96dd2366"><div class="ttname"><a href="classparlai_1_1core_1_1agents_1_1Agent.html#ac00c13f4c7dd1263bf9203fa96dd2366">parlai.core.agents.Agent.id</a></div><div class="ttdeci">id</div><div class="ttdef"><b>Definition:</b> <a href="parlai_2core_2agents_8py_source.html#l00058">agents.py:58</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogData_html_ada6f4dc4e2a8a84fba5f1e54d214d15e"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogData.html#ada6f4dc4e2a8a84fba5f1e54d214d15e">parlai.core.teachers.DialogData.share</a></div><div class="ttdeci">def share(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00579">teachers.py:579</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher_html"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html">parlai.core.teachers.FbDialogTeacher</a></div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00926">teachers.py:926</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_abf7e9a8868478220ca4df71dadeed4a9"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#abf7e9a8868478220ca4df71dadeed4a9">parlai.core.teachers.FixedDialogTeacher.lastY</a></div><div class="ttdeci">lastY</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00188">teachers.py:188</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_abe3521ed1cb416df863eb41d726ece67"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#abe3521ed1cb416df863eb41d726ece67">parlai.core.teachers.StreamDialogData._lock</a></div><div class="ttdeci">def _lock(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00869">teachers.py:869</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogData_html_a8c20c97b259bf583c53f47d235790813"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a8c20c97b259bf583c53f47d235790813">parlai.core.teachers.DialogData.__init__</a></div><div class="ttdeci">def __init__(self, opt, data_loader=None, cands=None, shared=None, kwargs)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00563">teachers.py:563</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1agents_1_1Agent_html_a27cb8206372681605b00dc28b81a7c39"><div class="ttname"><a href="classparlai_1_1core_1_1agents_1_1Agent.html#a27cb8206372681605b00dc28b81a7c39">parlai.core.agents.Agent.reset</a></div><div class="ttdeci">def reset(self)</div><div class="ttdef"><b>Definition:</b> <a href="parlai_2core_2agents_8py_source.html#l00092">agents.py:92</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_a7e5054e18ce919c0eb04188c801ddef1"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#a7e5054e18ce919c0eb04188c801ddef1">parlai.core.teachers.FixedDialogTeacher.random</a></div><div class="ttdeci">random</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00151">teachers.py:151</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1message_1_1Message_html"><div class="ttname"><a href="classparlai_1_1core_1_1message_1_1Message.html">parlai.core.message.Message</a></div><div class="ttdef"><b>Definition:</b> <a href="message_8py_source.html#l00013">message.py:13</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a3e1f85a8de230d8733272bd1e860cd92"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a3e1f85a8de230d8733272bd1e860cd92">parlai.core.teachers.AbstractImageTeacher.get_image_features</a></div><div class="ttdeci">def get_image_features(self, example)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01598">teachers.py:1598</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DataLoader_html_a2663781dd1e8cc85535e3cb075fbb8b7"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DataLoader.html#a2663781dd1e8cc85535e3cb075fbb8b7">parlai.core.teachers.DataLoader.run</a></div><div class="ttdeci">def run(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00085">teachers.py:85</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogTeacher_html_a6089018ef23e5f55862292d25628e6a5"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a6089018ef23e5f55862292d25628e6a5">parlai.core.teachers.DialogTeacher.data</a></div><div class="ttdeci">data</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00457">teachers.py:457</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a5e814d24d81975556ee474c89d5fee5a"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a5e814d24d81975556ee474c89d5fee5a">parlai.core.teachers.AbstractImageTeacher.imageEpochDone</a></div><div class="ttdeci">imageEpochDone</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01659">teachers.py:1659</a></div></div>
<div class="ttc" id="namespaceeval__ppl_html_a4d5b66ad0d8e1b8d7db27f256eda8340"><div class="ttname"><a href="namespaceeval__ppl.html#a4d5b66ad0d8e1b8d7db27f256eda8340">eval_ppl.int</a></div><div class="ttdeci">int</div><div class="ttdef"><b>Definition:</b> <a href="projects_2convai2_2baselines_2language__model_2eval__ppl_8py_source.html#l00102">eval_ppl.py:102</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogData_html_a83e3457f29a54ec455ad76f7eab6cfc4"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a83e3457f29a54ec455ad76f7eab6cfc4">parlai.core.teachers.DialogData.num_episodes</a></div><div class="ttdeci">def num_episodes(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00671">teachers.py:671</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogData_html_a4acc939bddc7bf81f0e19ae9fa9f197a"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogData.html#a4acc939bddc7bf81f0e19ae9fa9f197a">parlai.core.teachers.DialogData.data</a></div><div class="ttdeci">data</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00569">teachers.py:569</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1StreamDialogData_html_ae045cda37bbe4fd67fdca7f902de8862"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1StreamDialogData.html#ae045cda37bbe4fd67fdca7f902de8862">parlai.core.teachers.StreamDialogData.cur_episode</a></div><div class="ttdeci">cur_episode</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00887">teachers.py:887</a></div></div>
<div class="ttc" id="namespaceparlai_1_1utils_1_1misc_html"><div class="ttname"><a href="namespaceparlai_1_1utils_1_1misc.html">parlai.utils.misc</a></div><div class="ttdef"><b>Definition:</b> <a href="misc_8py_source.html#l00001">misc.py:1</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher_html_a4f5565f49b0aef6d084257b5090a7e40"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1AbstractImageTeacher.html#a4f5565f49b0aef6d084257b5090a7e40">parlai.core.teachers.AbstractImageTeacher.num_examples</a></div><div class="ttdeci">def num_examples(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01595">teachers.py:1595</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1agents_1_1Teacher_html_aa35e171610f8dd8e6a2fd5a87ad91e10"><div class="ttname"><a href="classparlai_1_1core_1_1agents_1_1Teacher.html#aa35e171610f8dd8e6a2fd5a87ad91e10">parlai.core.agents.Teacher.num_episodes</a></div><div class="ttdeci">def num_episodes(self)</div><div class="ttdef"><b>Definition:</b> <a href="parlai_2core_2agents_8py_source.html#l00217">agents.py:217</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher_html_af1501d26676b7cf0ed8f41d51c31e686"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FixedDialogTeacher.html#af1501d26676b7cf0ed8f41d51c31e686">parlai.core.teachers.FixedDialogTeacher.share</a></div><div class="ttdeci">def share(self)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00219">teachers.py:219</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1agents_1_1Teacher_html_a2a21915f2270b76ba0e99137d506af89"><div class="ttname"><a href="classparlai_1_1core_1_1agents_1_1Teacher.html#a2a21915f2270b76ba0e99137d506af89">parlai.core.agents.Teacher.epochDone</a></div><div class="ttdeci">epochDone</div><div class="ttdef"><b>Definition:</b> <a href="parlai_2core_2agents_8py_source.html#l00195">agents.py:195</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1DialogTeacher_html_a8dc7153ce190442ad5d35b255389bf5a"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1DialogTeacher.html#a8dc7153ce190442ad5d35b255389bf5a">parlai.core.teachers.DialogTeacher.startTime</a></div><div class="ttdeci">startTime</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l00447">teachers.py:447</a></div></div>
<div class="ttc" id="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher_html_a6cb23867e396fac5fdcde509b5da3942"><div class="ttname"><a href="classparlai_1_1core_1_1teachers_1_1FbDialogTeacher.html#a6cb23867e396fac5fdcde509b5da3942">parlai.core.teachers.FbDialogTeacher.setup_data</a></div><div class="ttdeci">def setup_data(self, path)</div><div class="ttdef"><b>Definition:</b> <a href="teachers_8py_source.html#l01044">teachers.py:1044</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
